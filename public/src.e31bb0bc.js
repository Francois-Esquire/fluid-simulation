(function () {function Cb(a){return a&&a.__esModule?{d:a.default}:{d:a}}var t=this;var Db={},sa=Object.getOwnPropertySymbols,Eb=Object.prototype.hasOwnProperty,Fb=Object.prototype.propertyIsEnumerable;function Gb(r){if(null==r)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(r)}function Hb(){try{if(!Object.assign)return!1;var r=new String("abc");if(r[5]="de","5"===Object.getOwnPropertyNames(r)[0])return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(r){return e[r]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(r){n[r]=r}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(o){return!1}}Db=Hb()?Object.assign:function(r,e){for(var t,n,o=Gb(r),a=1;a<arguments.length;a++){for(var $ in t=Object(arguments[a]))Eb.call(t,$)&&(o[$]=t[$]);if(sa){n=sa(t);for(var s=0;s<n.length;s++)Fb.call(t,n[s])&&(o[n[s]]=t[n[s]])}}return o};var Ib={};Ib=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8};var ta={};ta="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};var u,w,l={},d=l={};function W(){throw new Error("setTimeout has not been defined")}function X(){throw new Error("clearTimeout has not been defined")}function ua($){if(u===setTimeout)return setTimeout($,0);if((u===W||!u)&&setTimeout)return u=setTimeout,setTimeout($,0);try{return u($,0)}catch(e){try{return u.call(null,$,0)}catch(e){return u.call(this,$,0)}}}function Jb($){if(w===clearTimeout)return clearTimeout($);if((w===X||!w)&&clearTimeout)return w=clearTimeout,clearTimeout($);try{return w($)}catch(e){try{return w.call(null,$)}catch(e){return w.call(this,$)}}}!function(){try{u="function"==typeof setTimeout?setTimeout:W}catch($){u=W}try{w="function"==typeof clearTimeout?clearTimeout:X}catch($){w=X}}();var A,s=[],Y=!1,va=-1;function Kb(){Y&&A&&(Y=!1,A.length?s=A.concat(s):va=-1,s.length&&wa())}function wa(){if(!Y){var $=ua(Kb);Y=!0;for(var e=s.length;e;){for(A=s,s=[];++va<e;)A&&A[va].run();va=-1,e=s.length}A=null,Y=!1,Jb($)}}function xa($,e){this.fun=$,this.array=e}function e(){}d.nextTick=function($){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];s.push(new xa($,e)),1!==s.length||Y||ua(wa)},xa.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.env={},d.argv=[],d.version="",d.versions={},d.on=e,d.addListener=e,d.once=e,d.off=e,d.removeListener=e,d.removeAllListeners=e,d.emit=e,d.prependListener=e,d.prependOnceListener=e,d.listeners=function($){return[]},d.binding=function($){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function($){throw new Error("process.chdir is not supported")},d.umask=function(){return 0};var c={},Lb=/%[sdj%]/g,Z=function(r){if(!M(r)){for(var $=[],e=0;e<arguments.length;e++)$.push(p(arguments[e]));return $.join(" ")}e=1;for(var t=arguments,c=t.length,n=String(r).replace(Lb,function(r){if("%%"===r)return"%";if(e>=c)return r;switch(r){case"%s":return String(t[e++]);case"%d":return Number(t[e++]);case"%j":try{return JSON.stringify(t[e++])}catch($){return"[Circular]"}default:return r;}}),i=t[e];e<c;i=t[++e])L(i)||!x(i)?n+=" "+i:n+=" "+p(i);return n};c.format=Z;var ya=function(r,$){if(m(t.process))return function(){return ya(r,$).apply(this,arguments)};if(!0===l.noDeprecation)return r;var e=!1;return function(){if(!e){if(l.throwDeprecation)throw new Error($);l.traceDeprecation?console.trace($):console.error($),e=!0}return r.apply(this,arguments)}};c.deprecate=ya;var za,J={},Mb=function(r){if(m(za)&&(za=""),r=r.toUpperCase(),!J[r])if(new RegExp("\\b"+r+"\\b","i").test(za)){var $=l.pid;J[r]=function(){var e=Z.apply(c,arguments);console.error("%s %d: %s",r,$,e)}}else J[r]=function(){};return J[r]};function p(r,$){var e={seen:[],stylize:Ob};return arguments.length>=3&&(e.depth=arguments[2]),arguments.length>=4&&(e.colors=arguments[3]),ca($)?e.showHidden=$:$&&Da(e,$),m(e.showHidden)&&(e.showHidden=!1),m(e.depth)&&(e.depth=2),m(e.colors)&&(e.colors=!1),m(e.customInspect)&&(e.customInspect=!0),e.colors&&(e.stylize=Nb),K(e,r,e.depth)}c.debuglog=Mb;var _=p;function Nb(r,$){var e=p.styles[$];return e?"\x1B["+p.colors[e][0]+"m"+r+"\x1B["+p.colors[e][1]+"m":r}function Ob(r,$){return r}function Pb(r){var $={};return r.forEach(function(r,e){$[r]=!0}),$}function K(r,$,e){if(r.customInspect&&$&&Q($.inspect)&&$.inspect!==_&&(!$.constructor||$.constructor.prototype!==$)){var t=$.inspect(e,r);return M(t)||(t=K(r,t,e)),t}var c=Qb(r,$);if(c)return c;var n=Object.keys($),i=Pb(n);if(r.showHidden&&(n=Object.getOwnPropertyNames($)),P($)&&(n.indexOf("message")>=0||n.indexOf("description")>=0))return aa($);if(0===n.length){if(Q($)){var o=$.name?": "+$.name:"";return r.stylize("[Function"+o+"]","special")}if(N($))return r.stylize(RegExp.prototype.toString.call($),"regexp");if(ea($))return r.stylize(Date.prototype.toString.call($),"date");if(P($))return aa($)}var a,s="",O=!1,p=["{","}"];(Aa($)&&(O=!0,p=["[","]"]),Q($))&&(s=" [Function"+($.name?": "+$.name:"")+"]");return N($)&&(s=" "+RegExp.prototype.toString.call($)),ea($)&&(s=" "+Date.prototype.toUTCString.call($)),P($)&&(s=" "+aa($)),0!==n.length||O&&0!=$.length?e<0?N($)?r.stylize(RegExp.prototype.toString.call($),"regexp"):r.stylize("[Object]","special"):(r.seen.push($),a=O?Rb(r,$,e,i,n):n.map(function(t){return ba(r,$,e,i,t,O)}),r.seen.pop(),Sb(a,s,p)):p[0]+s+p[1]}function Qb(r,$){if(m($))return r.stylize("undefined","undefined");if(M($)){var e="'"+JSON.stringify($).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,"\"")+"'";return r.stylize(e,"string")}return Ba($)?r.stylize(""+$,"number"):ca($)?r.stylize(""+$,"boolean"):L($)?r.stylize("null","null"):void 0}function aa(r){return"["+Error.prototype.toString.call(r)+"]"}function Rb(r,$,e,t,c){for(var n=[],i=0,o=$.length;i<o;++i)Ea($,String(i))?n.push(ba(r,$,e,t,String(i),!0)):n.push("");return c.forEach(function(c){c.match(/^\d+$/)||n.push(ba(r,$,e,t,c,!0))}),n}function ba(r,$,e,t,c,n){var i,o,a;if((a=Object.getOwnPropertyDescriptor($,c)||{value:$[c]}).get?o=a.set?r.stylize("[Getter/Setter]","special"):r.stylize("[Getter]","special"):a.set&&(o=r.stylize("[Setter]","special")),Ea(t,c)||(i="["+c+"]"),o||(r.seen.indexOf(a.value)<0?(o=L(e)?K(r,a.value,null):K(r,a.value,e-1)).indexOf("\n")>-1&&(o=n?o.split("\n").map(function(r){return"  "+r}).join("\n").substr(2):"\n"+o.split("\n").map(function(r){return"   "+r}).join("\n")):o=r.stylize("[Circular]","special")),m(i)){if(n&&c.match(/^\d+$/))return o;(i=JSON.stringify(""+c)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(i=i.substr(1,i.length-2),i=r.stylize(i,"name")):(i=i.replace(/'/g,"\\'").replace(/\\"/g,"\"").replace(/(^"|"$)/g,"'"),i=r.stylize(i,"string"))}return i+": "+o}function Sb(r,$,e){return r.reduce(function(r,$){return 0,$.indexOf("\n")>=0&&0,r+$.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?e[0]+(""===$?"":$+"\n ")+" "+r.join(",\n  ")+" "+e[1]:e[0]+$+" "+r.join(", ")+" "+e[1]}function Aa(r){return Array.isArray(r)}c.inspect=_,p.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},p.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var Tb=Aa;function ca(r){return"boolean"==typeof r}c.isArray=Tb;var Ub=ca;function L(r){return null===r}c.isBoolean=Ub;var Vb=L;function Wb(r){return null==r}c.isNull=Vb;var Xb=Wb;function Ba(r){return"number"==typeof r}c.isNullOrUndefined=Xb;var Yb=Ba;function M(r){return"string"==typeof r}c.isNumber=Yb;var Zb=M;function $b(r){return"symbol"==typeof r}c.isString=Zb;var _b=$b;function m(r){return void 0===r}c.isSymbol=_b;var ac=m;function N(r){return x(r)&&"[object RegExp]"===$(r)}c.isUndefined=ac;var da=N;function x(r){return"object"==typeof r&&null!==r}c.isRegExp=da;var bc=x;function ea(r){return x(r)&&"[object Date]"===$(r)}c.isObject=bc;var fa=ea;function P(r){return x(r)&&("[object Error]"===$(r)||r instanceof Error)}c.isDate=fa;var Ca=P;function Q(r){return"function"==typeof r}c.isError=Ca;var ga=Q;function cc(r){return null===r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||"symbol"==typeof r||void 0===r}c.isFunction=ga;var ha=cc;c.isPrimitive=ha;function $(r){return Object.prototype.toString.call(r)}function ia(r){return r<10?"0"+r.toString(10):r.toString(10)}c.isBuffer=Ib;var dc=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function ec(){var r=new Date,$=[ia(r.getHours()),ia(r.getMinutes()),ia(r.getSeconds())].join(":");return[r.getDate(),dc[r.getMonth()],$].join(" ")}var fc=function(){console.log("%s - %s",ec(),Z.apply(c,arguments))};c.log=fc;c.inherits=ta;var Da=function(r,$){if(!$||!x($))return r;for(var e=Object.keys($),t=e.length;t--;)r[e[t]]=$[e[t]];return r};function Ea(r,$){return Object.prototype.hasOwnProperty.call(r,$)}c._extend=Da;var b={};function Fa(r,$){if(r===$)return 0;for(var t=r.length,e=$.length,n=0,a=Math.min(t,e);n<a;++n)if(r[n]!==$[n]){t=r[n],e=$[n];break}return t<e?-1:e<t?1:0}function B(r){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(r):!(null==r||!r._isBuffer)}var gc=Object.prototype.hasOwnProperty,Ga=Array.prototype.slice,Ha="foo"===function(){}.name;function Ia(r){return Object.prototype.toString.call(r)}function Ja(r){return!B(r)&&"function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(r):!!r&&(r instanceof DataView||!!(r.buffer&&r.buffer instanceof ArrayBuffer)))}var a=b=Na,hc=/\s*function\s+([^\(\s]*)\s*/;function Ka(r){if(ga(r)){if(Ha)return r.name;var $=r.toString().match(hc);return $&&$[1]}}function La(r,$){return"string"==typeof r?r.length<$?r:r.slice(0,$):r}function Ma(r){if(Ha||!ga(r))return _(r);var $=Ka(r);return"[Function"+($?": "+$:"")+"]"}function ic(r){return La(Ma(r.actual),128)+" "+r.operator+" "+La(Ma(r.expected),128)}function i(r,$,t,e,n){throw new a.AssertionError({message:t,actual:r,expected:$,operator:e,stackStartFunction:n})}function Na(r,$){r||i(r,!0,$,"==",a.ok)}function y(r,$,t,e){if(r===$)return!0;if(B(r)&&B($))return 0===Fa(r,$);if(fa(r)&&fa($))return r.getTime()===$.getTime();if(da(r)&&da($))return r.source===$.source&&r.global===$.global&&r.multiline===$.multiline&&r.lastIndex===$.lastIndex&&r.ignoreCase===$.ignoreCase;if(null!==r&&"object"==typeof r||null!==$&&"object"==typeof $){if(Ja(r)&&Ja($)&&Ia(r)===Ia($)&&!(r instanceof Float32Array||r instanceof Float64Array))return 0===Fa(new Uint8Array(r.buffer),new Uint8Array($.buffer));if(B(r)!==B($))return!1;var n=(e=e||{actual:[],expected:[]}).actual.indexOf(r);return-1!==n&&n===e.expected.indexOf($)||(e.actual.push(r),e.expected.push($),jc(r,$,t,e))}return t?r===$:r==$}function Oa(r){return"[object Arguments]"==Object.prototype.toString.call(r)}function jc(r,$,t,e){if(null==r||null==$)return!1;if(ha(r)||ha($))return r===$;if(t&&Object.getPrototypeOf(r)!==Object.getPrototypeOf($))return!1;var n=Oa(r),a=Oa($);if(n&&!a||!n&&a)return!1;if(n)return y(r=Ga.call(r),$=Ga.call($),t);var l,i,s=Ta(r),u=Ta($);if(s.length!==u.length)return!1;for(s.sort(),u.sort(),i=s.length-1;i>=0;i--)if(s[i]!==u[i])return!1;for(i=s.length-1;i>=0;i--)if(!y(r[l=s[i]],$[l],t,e))return!1;return!0}function Pa(r,$,t){y(r,$,!0)&&i(r,$,t,"notDeepStrictEqual",Pa)}function Qa(r,$){if(!r||!$)return!1;if("[object RegExp]"==Object.prototype.toString.call($))return $.test(r);try{if(r instanceof $)return!0}catch(t){}return!Error.isPrototypeOf($)&&!0===$.call({},r)}function kc(r){var $;try{r()}catch(t){$=t}return $}function Ra(r,$,t,e){var n;if("function"!=typeof $)throw new TypeError("\"block\" argument must be a function");"string"==typeof t&&(e=t,t=null),n=kc($),e=(t&&t.name?" ("+t.name+").":".")+(e?" "+e:"."),r&&!n&&i(n,t,"Missing expected exception"+e);var a="string"==typeof e,l=!r&&n&&!t;if((!r&&Ca(n)&&a&&Qa(n,t)||l)&&i(n,t,"Got unwanted exception"+e),r&&n&&t&&!Qa(n,t)||!r&&n)throw n}function Sa(r,$){r||i(r,!0,$,"==",Sa)}a.AssertionError=function(r){this.name="AssertionError",this.actual=r.actual,this.expected=r.expected,this.operator=r.operator,r.message?(this.message=r.message,this.generatedMessage=!1):(this.message=ic(this),this.generatedMessage=!0);var $=r.stackStartFunction||i;if(Error.captureStackTrace)Error.captureStackTrace(this,$);else{var t=new Error;if(t.stack){var e=t.stack,n=Ka($),a=e.indexOf("\n"+n);if(a>=0){var l=e.indexOf("\n",a+1);e=e.substring(l+1)}this.stack=e}}},ta(a.AssertionError,Error),a.fail=i,a.ok=Na,a.equal=function(r,$,t){r!=$&&i(r,$,t,"==",a.equal)},a.notEqual=function(r,$,t){r==$&&i(r,$,t,"!=",a.notEqual)},a.deepEqual=function(r,$,t){y(r,$,!1)||i(r,$,t,"deepEqual",a.deepEqual)},a.deepStrictEqual=function(r,$,t){y(r,$,!0)||i(r,$,t,"deepStrictEqual",a.deepStrictEqual)},a.notDeepEqual=function(r,$,t){y(r,$,!1)&&i(r,$,t,"notDeepEqual",a.notDeepEqual)},a.notDeepStrictEqual=Pa,a.strictEqual=function(r,$,t){r!==$&&i(r,$,t,"===",a.strictEqual)},a.notStrictEqual=function(r,$,t){r===$&&i(r,$,t,"!==",a.notStrictEqual)},a.throws=function(r,$,t){Ra(!0,r,$,t)},a.doesNotThrow=function(r,$,t){Ra(!1,r,$,t)},a.ifError=function(r){if(r)throw r},a.strict=Db(Sa,a,{equal:a.strictEqual,deepEqual:a.deepStrictEqual,notEqual:a.notStrictEqual,notDeepEqual:a.notDeepStrictEqual}),a.strict.strict=a.strict;var Ta=Object.keys||function(r){var $=[];for(var t in r)gc.call(r,t)&&$.push(t);return $};var lc={};function mc(e){b(!e||"object"==typeof e,"pex-gl: createGL requires opts argument to be null or an object"),e||(e={});let t=e.canvas;const n=e.pixelRatio||1,o=!e.width&&!e.height;if(!t){if(t=document.createElement("canvas"),o){const e=document.createElement("meta");e.setAttribute("name","viewport"),e.setAttribute("content","width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0, shrink-to-fit=0.0"),document.head.appendChild(e)}const r=()=>{o&&(document.body.style.margin="0px",document.body.style.overflow="hidden",document.body.style.background="#000"),document.body.appendChild(t)},i=e.width||window.innerWidth,a=e.height||window.innerHeight;1!==n?(t.style.width=i+"px",t.style.height=a+"px",t.width=i*n,t.height=a*n):(t.width=i*n,t.height=a*n),document.body?r():document.addEventListener("DOMContentLoaded",r)}const r=["webgl","experimental-webgl"];for(var i=0;i<r.length;i++)try{const n=t.getContext(r[i],e);if(!n)throw new Error("Canvas.getContext returned null");return console.info("pex-gl","Creating",r[i],"succeeded"),n}catch(a){console.warn("pex-gl","Creating",r[i],"failed",a)}}lc=mc;var Ua={};Ua=!0;var Va={};(function(){var e,r,n,$,o,t;"undefined"!=typeof performance&&null!==performance&&performance.now?Va=function(){return performance.now()}:null!=l&&l.hrtime?(Va=function(){return(e()-o)/1e6},r=l.hrtime,$=(e=function(){var e;return 1e9*(e=r())[0]+e[1]})(),t=1e9*l.uptime(),o=$-t):Date.now?(Va=function(){return Date.now()-n},n=Date.now()):(Va=function(){return new Date().getTime()-n},n=new Date().getTime())}).call(Va);for(var ja={},n="undefined"==typeof window?t:window,O=["moz","webkit"],z="AnimationFrame",R=n["request"+z],ka=n["cancel"+z]||n["cancelRequest"+z],C=0;!R&&C<O.length;C++)R=n[O[C]+"Request"+z],ka=n[O[C]+"Cancel"+z]||n[O[C]+"CancelRequest"+z];if(!R||!ka){var Wa=0,Xa=0,r=[],nc=1e3/60;R=function($){if(0===r.length){var o=Va(),a=Math.max(0,nc-(o-Wa));Wa=a+o,setTimeout(function(){var $=r.slice(0);r.length=0;for(var o=0;o<$.length;o++)if(!$[o].cancelled)try{$[o].callback(Wa)}catch(a){setTimeout(function(){throw a},0)}},Math.round(a))}return r.push({handle:++Xa,callback:$,cancelled:!1}),Xa},ka=function($){for(var o=0;o<r.length;o++)r[o].handle===$&&(r[o].cancelled=!0)}}(ja=function($){return R.call(n,$)}).cancel=function(){ka.apply(n,arguments)},ja.polyfill=function($){$||($=n),$.requestAnimationFrame=R,$.cancelAnimationFrame=ka};var j={},oc=Hc;var pc={},D=1e3,E=60*D,F=60*E,G=24*F,qc=365.25*G;function rc($){if(!(($=String($)).length>100)){var r=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec($);if(r){var a=parseFloat(r[1]);switch((r[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*qc;case"days":case"day":case"d":return a*G;case"hours":case"hour":case"hrs":case"hr":case"h":return a*F;case"minutes":case"minute":case"mins":case"min":case"m":return a*E;case"seconds":case"second":case"secs":case"sec":case"s":return a*D;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return;}}}}function sc($){return $>=G?Math.round($/G)+"d":$>=F?Math.round($/F)+"h":$>=E?Math.round($/E)+"m":$>=D?Math.round($/D)+"s":$+"ms"}function tc($){return S($,G,"day")||S($,F,"hour")||S($,E,"minute")||S($,D,"second")||$+" ms"}function S($,r,a){if(!($<r))return $<1.5*r?Math.floor($/r)+" "+a:Math.ceil($/r)+" "+a+"s"}pc=function($,r){r=r||{};var a=typeof $;if("string"===a&&$.length>0)return rc($);if("number"===a&&!1===isNaN($))return r.long?tc($):sc($);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify($))};var f={},Ya=zc;(f=f=la.debug=la.default=la).coerce=Ya;var uc=xc;f.disable=uc;var Za=wc;f.enable=Za;var $a=yc;f.enabled=$a;f.humanize=pc;var H=[];f.names=H;var I=[];f.skips=I;var _a,ab={};function vc(e){var $,r=0;for($ in e)r=(r<<5)-r+e.charCodeAt($),r|=0;return f.colors[Math.abs(r)%f.colors.length]}function la(e){function $(){if($.enabled){var e=$,r=+new Date,t=r-(_a||r);e.diff=t,e.prev=_a,e.curr=r,_a=r;for(var o=new Array(arguments.length),s=0;s<o.length;s++)o[s]=arguments[s];o[0]=Ya(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var a=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function($,r){if("%%"===$)return $;a++;var t=ab[r];if("function"==typeof t){var s=o[a];$=t.call(e,s),o.splice(a,1),a--}return $}),f.formatArgs.call(e,o),($.log||f.log||console.log.bind(console)).apply(e,o)}}return $.namespace=e,$.enabled=$a(e),$.useColors=f.useColors(),$.color=vc(e),"function"==typeof f.init&&f.init($),$}function wc(e){f.save(e),H=[],f.names=H,I=[],f.skips=I;for(var $=("string"==typeof e?e:"").split(/[\s,]+/),r=$.length,t=0;t<r;t++)$[t]&&("-"===(e=$[t].replace(/\*/g,".*?"))[0]?I.push(new RegExp("^"+e.substr(1)+"$")):H.push(new RegExp("^"+e+"$")))}function xc(){Za("")}function yc(e){var $,r;for($=0,r=I.length;$<r;$++)if(I[$].test(e))return!1;for($=0,r=H.length;$<r;$++)if(H[$].test(e))return!0;return!1}function zc(e){return e instanceof Error?e.stack||e.message:e}f.formatters=ab;(j=j=f).log=oc;var Ac=Gc;j.formatArgs=Ac;var Bc=Ic;j.save=Bc;var Cc=bb;j.load=Cc;var Dc=Fc;j.useColors=Dc;var T="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:Jc();j.storage=T;var Ec=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function Fc(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Gc(e){var o=this.useColors;if(e[0]=(o?"%c":"")+this.namespace+(o?" %c":" ")+e[0]+(o?"%c ":" ")+"+"+j.humanize(this.diff),o){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var $=0,t=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&($++,"%c"===e&&(t=$))}),e.splice(t,0,r)}}function Hc(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function Ic(e){try{null==e?T.removeItem("debug"):T.debug=e}catch(o){}}function bb(){var e;try{e=T.debug}catch(o){}return!e&&void 0!==l&&"env"in l&&(e=void 0),e}function Jc(){try{return window.localStorage}catch(e){}}j.colors=Ec,j.formatters.j=function(e){try{return JSON.stringify(e)}catch(o){return"[UnexpectedJSONParseError]: "+o.message}},j.enable(bb());var v={};function Kc(r,$){Object.keys($).forEach($=>{if(-1===r.indexOf($))throw new Error(`Unknown prop "${$}"`)})}v=Kc;var cb={};const Lc=["name","data","width","height","pixelFormat","encoding","flipY","mipmap","target","min","mag","wrap","wrapS","wrapT","aniso","premultiplayAlpha"];function Mc(e,a){v(Lc,a);const t=e.gl,r={class:"texture",handle:t.createTexture(),target:a.target,width:0,height:0,_update:db,_dispose:function(){t.deleteTexture(this.handle),this.handle=null}};return db(e,r,a),r}function U(e,a){return void 0!==e?e:a}function db(e,a,t){const r=e.gl,i=e.PixelFormat;let n,T,o,$=null,l=t.width,p=t.height,s=U(t.flipY,U(a.flipY,!1)),d=t.target||a.target,E=t.pixelFormat||a.pixelFormat||e.PixelFormat.RGBA8,A=t.encoding||a.encoding||e.Encoding.Linear,h=t.min||a.min||r.NEAREST,u=t.mag||a.mag||r.NEAREST,m=t.wrapS||a.wrapS||t.wrap||a.wrap||r.CLAMP_TO_EDGE,_=t.wrapT||a.wrapT||t.wrap||a.wrap||r.CLAMP_TO_EDGE,g=t.aniso||a.aniso||0,x=U(t.premultiplayAlpha,U(a.premultiplayAlpha,!1));var c=r.getExtension("EXT_texture_filter_anisotropic");r.activeTexture(r.TEXTURE0+0),r.bindTexture(a.target,a.handle),e.state.activeTextures[0]=a,r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,s),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,x),r.texParameteri(d,r.TEXTURE_MAG_FILTER,u),r.texParameteri(d,r.TEXTURE_MIN_FILTER,h),r.texParameteri(d,r.TEXTURE_WRAP_S,m),r.texParameteri(d,r.TEXTURE_WRAP_T,_),c&&g>0&&r.texParameterf(d,c.TEXTURE_MAX_ANISOTROPY_EXT,g);const w=t.data?t.data:t;if(w&&w.nodeName)b(w instanceof window.HTMLImageElement||w instanceof window.HTMLVideoElement||w instanceof window.HTMLCanvasElement,"Texture2D.update opts has to be Image, Canvas or Video element"),l=w.width||w.videoHeight,p=w.height||w.videoHeight,n=r.RGBA,o=r.RGBA,T=r.UNSIGNED_BYTE,r.texImage2D(d,0,n,o,T,w),a.width=l,a.height=p;else if("object"==typeof t){if(b(!$||Array.isArray(t.data)||t.data instanceof Uint8Array||t.data instanceof Float32Array,"Texture2D.update opts.data has to be null or an Array, Uint8Array or Float32Array"),$=t.data?t.data.data||t.data:null,!t.width&&$&&$.width&&(l=$.width),!t.height&&$&&$.height&&(l=$.height),b(!$||void 0!==l&&void 0!==p,"Texture2D.update opts.width and opts.height are required when providing opts.data"),E===i.Depth||E===i.Depth16?(o=r.DEPTH_COMPONENT,n=r.DEPTH_COMPONENT,T=r.UNSIGNED_SHORT):E===i.Depth24?(o=r.DEPTH_COMPONENT,n=r.DEPTH_COMPONENT,T=r.UNSIGNED_INT):E===i.RGBA8?(o=r.RGBA,n=r.RGBA,T=r.UNSIGNED_BYTE):E===i.RGBA32F?(o=r.RGBA,n=r.RGBA,T=r.FLOAT):E===i.RGBA16F?(o=r.RGBA,n=r.RGBA,T=r.HALF_FLOAT):E===i.R32F?(o=r.ALPHA,n=r.ALPHA,T=r.FLOAT):E&&b.fail(`Unknown texture pixel format: ${t.format}`),d===r.TEXTURE_2D)Array.isArray($)&&(T===r.UNSIGNED_BYTE?$=new Uint8Array($):T===r.FLOAT?$=new Float32Array($):T===r.HALF_FLOAT?$=new Float32Array($):b.fail(`Unknown texture data type: ${T}`)),l&&p&&(r.texImage2D(d,0,n,l,p,0,o,T,$),a.width=l,a.height=p);else if(d===r.TEXTURE_CUBE_MAP){b(!$||Array.isArray($)&&6===$.length,"TextureCube requires data for 6 faces");for(let e=0;e<6;e++){let t=$?$[e].data||$[e]:null;const i=r.TEXTURE_CUBE_MAP_POSITIVE_X+e;Array.isArray(t)?(T===r.UNSIGNED_BYTE?t=new Uint8Array(t):T===r.FLOAT?t=new Float32Array($):b.fail(`Unknown texture data type: ${T}`),r.texImage2D(i,0,n,l,p,0,o,T,t)):t&&t.nodeName?r.texImage2D(i,0,n,o,T,t):r.texImage2D(i,0,n,l,p,0,o,T,t),a.width=l,a.height=p}}}else b.fail("Texture2D.update opts has to be a HTMLElement or Object");return t.mipmap&&r.generateMipmap(a.target),a.target=d,a.pixelFormat=E,a.encoding=A,a.min=h,a.mag=u,a.wrapS=m,a.wrapT=_,a.format=o,a.flipY=s,a.internalFormat=n,a.type=T,a.info="",a.info+=Object.keys(e.PixelFormat).find(a=>e.PixelFormat[a]===E),a.info+="_",a.info+=Object.keys(e.Encoding).find(a=>e.Encoding[a]===A),a}cb=Mc;var Nc={};const eb=j("context/framebuffer");function Oc(e,r){const t=e.gl,E={class:"framebuffer",handle:t.createFramebuffer(),target:t.FRAMEBUFFER,drawBuffers:[],color:[],depth:null,width:0,height:0,refCount:0,_update:fb,_dispose:function(){t.deleteFramebuffer(this.handle),this.color=null,this.depth=null}};return(r.color||r.depth)&&fb(e,E,r),E}function fb(e,r,t){const E=e.gl;r.color=t.color.map(e=>{const r=e.texture?e:{texture:e};return r.level=0,r.target||(r.target=r.texture.target),r}),t.depth&&!t.depth.texture&&(t.depth={texture:t.depth}),r.depth=t.depth,r.width=r.color[0].texture.width,r.height=r.color[0].texture.height,E.bindFramebuffer(r.target,r.handle),r.drawBuffers.length=0;for(let R=0;R<r.color.length;R++){const e=r.color[R];r.drawBuffers.push(E.COLOR_ATTACHMENT0+R),E.framebufferTexture2D(r.target,E.COLOR_ATTACHMENT0+R,e.target,e.texture.handle,e.level)}for(let R=r.color.length;R<e.capabilities.maxColorAttachments;R++)E.framebufferTexture2D(r.target,E.COLOR_ATTACHMENT0+R,E.TEXTURE_2D,null,0);if(r.depth){e.debugMode&&eb("fbo attaching depth",r.depth);const t=r.depth;t.texture.target===E.RENDERBUFFER?E.framebufferRenderbuffer(E.FRAMEBUFFER,E.DEPTH_ATTACHMENT,E.RENDERBUFFER,t.texture.handle):E.framebufferTexture2D(E.FRAMEBUFFER,E.DEPTH_ATTACHMENT,t.texture.target,t.texture.handle,t.level)}else e.debugMode&&eb("fbo deattaching depth"),E.framebufferRenderbuffer(E.FRAMEBUFFER,E.DEPTH_ATTACHMENT,E.RENDERBUFFER,null),E.framebufferTexture2D(r.target,E.DEPTH_ATTACHMENT,E.TEXTURE_2D,null,0);var a=[];a[E.FRAMEBUFFER_COMPLETE]="FRAMEBUFFER_COMPLETE",a[E.FRAMEBUFFER_INCOMPLETE_ATTACHMENT]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",a[E.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",a[E.FRAMEBUFFER_INCOMPLETE_DIMENSIONS]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",a[E.FRAMEBUFFER_UNSUPPORTED]="FRAMEBUFFER_UNSUPPORTED";var F=E.checkFramebufferStatus(E.FRAMEBUFFER);b(F===E.FRAMEBUFFER_COMPLETE,`FBO incomplete ${a[F]}`),E.bindFramebuffer(r.target,null)}Nc=Oc;var Pc={};function Qc(e,r){const t=e.gl,a={class:"renderbuffer",handle:t.createRenderbuffer(),target:t.RENDERBUFFER,width:0,height:0,_update:gb,_dispose:function(){t.deleteRenderbuffer(this.handle),this.color=null,this.depth=null}};return gb(e,a,r),a}function gb(e,r,t){Object.assign(r,t);const a=e.gl;b(r.pixelFormat===e.PixelFormat.Depth16,"Only PixelFormat.Depth16 is supported for renderbuffers"),r.format=a.DEPTH_COMPONENT16,a.bindRenderbuffer(r.target,r.handle),a.renderbufferStorage(r.target,r.format,r.width,r.height),a.bindRenderbuffer(r.target,null)}Pc=Qc;var Rc={};const Sc=["name","framebuffer","color","depth","clearColor","clearDepth"];function Tc(e,a){v(Sc,a);const r={class:"pass",opts:a,clearColor:a.clearColor,clearDepth:a.clearDepth,_dispose:function(){this.opts=null,this.clearColor=null,this.clearDepth=null,this.framebuffer===e.defaultState.pass.sharedFramebuffer&&0==--e.defaultState.pass.sharedFramebuffer.refCount&&(e.defaultState.pass.sharedFramebuffer._dispose(),e.defaultState.pass.sharedFramebuffer=null),this.framebuffer=null}};return(a.color||a.depth)&&(e.defaultState.pass.sharedFramebuffer||(e.defaultState.pass.sharedFramebuffer=e.framebuffer({})),r.framebuffer=e.defaultState.pass.sharedFramebuffer,e.defaultState.pass.sharedFramebuffer.refCount++),r.framebuffer||(r.framebuffer=e.defaultState.pass.framebuffer),r}Rc=Tc;var ma={};const Uc=["vert","frag","program","depthWrite","depthTest","depthFunc","blend","blendSrcRGBFactor","blendSrcAlphaFactor","blendDstRGBFactor","blendDstAlphaFactor","cullFace","cullFaceMode","colorMask","primitive"];function Vc(r,e){v(Uc,e);const a=Object.assign({class:"pipeline",vert:null,frag:null,program:null,depthWrite:!0,depthTest:!1,depthFunc:r.DepthFunc.LessEqual,blend:!1,blendSrcRGBFactor:r.BlendFactor.One,blendSrcAlphaFactor:r.BlendFactor.One,blendDstRGBFactor:r.BlendFactor.One,blendDstAlphaFactor:r.BlendFactor.One,cullFace:!1,cullFaceMode:r.Face.Back,colorMask:[!0,!0,!0,!0],primitive:r.Primitive.Triangles,_dispose:function(){this.vert=null,this.frag=null,this.program&&0==--this.program.refCount&&this.program.handle&&r.dispose(this.program),this.program=null}},e);if(e.vert&&e.frag&&(a.program=r.program({vert:e.vert,frag:e.frag})),a.program&&!a.vertexLayout){a.program.refCount++;const r=a.program.attributesPerLocation;a.vertexLayout=Object.keys(r).map(e=>{const a=r[e];return[a.name,parseInt(e,10),a.size]})}return a}ma=Vc;var Wc={};const hb=j("context/program");function Xc(e,r){const t=e.gl,a={class:"program",handle:t.createProgram(),attributes:[],attributesPerLocation:{},uniforms:{},refCount:0,_update:ib,_dispose:function(){t.deleteProgram(this.handle),this.handle=null,this.attributes=null,this.attributesPerLocation=null,this.uniforms=null},setUniform:function(r,t){const a=this.uniforms[r];if(void 0===a)throw new Error(`Uniform ${r} is not defined`);const o=e.gl,n=a.type,c=a.location;switch(a.type){case o.INT:case o.BOOL:o.uniform1i(c,t);break;case o.FLOAT:o.uniform1f(c,t);break;case o.FLOAT_VEC2:o.uniform2fv(c,t);break;case o.FLOAT_VEC3:o.uniform3fv(c,t);break;case o.FLOAT_VEC4:o.uniform4fv(c,t);break;case o.FLOAT_MAT2:o.uniformMatrix2fv(c,!1,t);break;case o.FLOAT_MAT3:o.uniformMatrix3fv(c,!1,t);break;case o.FLOAT_MAT4:o.uniformMatrix4fv(c,!1,t);break;case o.SAMPLER_2D:case o.SAMPLER_CUBE:o.uniform1i(c,t);break;default:throw new Error(`Invalid uniform type ${n} : ${e.getGLString(n)}`);}}};return ib(e,a,r),a}function ib(e,r,t){b("string"==typeof t.vert,"Vertex shader source must be a string"),b("string"==typeof t.frag,"Fragment shader source must be a string");const a=e.gl,o=jb(e,r,a.VERTEX_SHADER,t.vert),n=jb(e,r,a.FRAGMENT_SHADER,t.frag);if(a.attachShader(r.handle,o),a.attachShader(r.handle,n),a.linkProgram(r.handle),!a.getProgramParameter(r.handle,a.LINK_STATUS))throw new Error("Program: "+a.getProgramInfoLog(r.handle));a.deleteShader(o),a.deleteShader(n),Yc(e,r),Zc(e,r)}function jb(e,r,t,a){const o=e.gl,n=o.createShader(t);if(o.shaderSource(n,a+"\n"),o.compileShader(n),!o.getShaderParameter(n,o.COMPILE_STATUS)){const e=t===o.VERTEX_SHADER?"Vertex":"Fragment";throw hb(e+" shader compilation failed"),hb(a),new Error(e+" shader error: "+o.getShaderInfoLog(n))}return n}function Yc(e,r){const t=e.gl;r.uniforms={};const a=t.getProgramParameter(r.handle,t.ACTIVE_UNIFORMS);for(let o=0;o<a;++o){const a=t.getActiveUniform(r.handle,o),n=a.name;let c=0;switch(a.type){case t.INT:case t.BOOL:case t.FLOAT:c=1;break;case t.FLOAT_VEC2:c=2;break;case t.FLOAT_VEC3:c=3;break;case t.FLOAT_VEC4:case t.FLOAT_MAT2:c=4;break;case t.FLOAT_MAT3:c=9;break;case t.FLOAT_MAT4:c=16;break;case t.SAMPLER_2D:case t.SAMPLER_CUBE:c=0;break;default:throw new Error(`Unknwon attribute type ${a.type} : ${e.getGLString(a.type)}`);}if(r.uniforms[n]={name:n,type:a.type,size:c,location:t.getUniformLocation(r.handle,n)},a.size>1)for(let e=1;e<a.size;e++){const o=a.name.substr(0,a.name.indexOf("[")+1)+e+"]";r.uniforms[o]={type:a.type,location:t.getUniformLocation(r.handle,o)}}}}function Zc(e,r){const t=e.gl;r.attributes={},r.attributesPerLocation={};const a=t.getProgramParameter(r.handle,t.ACTIVE_ATTRIBUTES);for(let o=0;o<a;++o){const a=t.getActiveAttrib(r.handle,o),n=a.name;let c=0;switch(a.type){case t.FLOAT:c=1;break;case t.FLOAT_VEC2:c=2;break;case t.FLOAT_VEC3:c=3;break;case t.FLOAT_VEC4:c=4;break;case t.FLOAT_MAT4:c=16;break;default:throw new Error(`Unknwon attribute type ${a.type} : ${e.getGLString(a.type)}`);}const s={name:n,type:a.type,size:c,location:t.getAttribLocation(r.handle,n)};r.attributes[n]=s,r.attributesPerLocation[s.location]=s}}Wc=Xc;var kb={};const lb=["target","data","usage","type","offset"];function $c(e,a){const r=e.gl;v(lb,a),b(a.target===r.ARRAY_BUFFER||a.target===r.ELEMENT_ARRAY_BUFFER,"Invalid buffer target");const t={class:a.target===r.ARRAY_BUFFER?"vertexBuffer":"indexBuffer",handle:r.createBuffer(),target:a.target,usage:a.usage||r.STATIC_DRAW,_update:mb,_dispose:function(){r.deleteBuffer(this.handle),this.handle=null}};return mb(e,t,a),t}function mb(e,a,r){v(lb,r);const t=e.gl;let n=r.data||r,l=r.type||a.type,f=r.offset||0;if(Array.isArray(n)){l||(r.target===t.ARRAY_BUFFER&&(l=e.DataType.Float32),r.target===t.ELEMENT_ARRAY_BUFFER&&(l=e.DataType.Uint16));var $=n,c=Array.isArray($[0])?$[0].length:1,s=c*$.length;if(l===e.DataType.Float32?n=new Float32Array(1===c?$:s):l===e.DataType.Uint8?n=new Uint8Array(1===c?$:s):l===e.DataType.Uint16?n=new Uint16Array(1===c?$:s):l===e.DataType.Uint32&&(n=new Uint32Array(1===c?$:s)),c>1)for(var o=0;o<$.length;o++)for(var i=0;i<c;i++){n[o*c+i]=$[o][i]}}else if(n instanceof Float32Array)l=e.DataType.Float32;else if(n instanceof Uint8Array)l=e.DataType.Uint8;else if(n instanceof Uint16Array)l=e.DataType.Uint16;else if(n instanceof Uint32Array)l=e.DataType.Uint32;else if(!(n instanceof ArrayBuffer))throw new Error(`Unknown buffer data type: ${n.constructor}`);a.type=l,a.length=n.length,t.bindBuffer(a.target,a.handle),f?t.bufferSubData(a.target,f,n):t.bufferData(a.target,n,a.usage)}kb=$c;var _c={};const ad=["target"];function bd(e,t){const r=e.gl;v(ad,t=t||{});const a=Object.assign({class:"query",handle:r.createQuery(),target:null,state:e.QueryState.Ready,result:null,_begin:cd,_end:dd,_available:ed,_dispose:function(){r.deleteQuery(this.handle),this.handle=null}},t);return a.target||(a.target=e.QueryTarget.TimeElapsed),a}function cd(e,t){return t.state===e.QueryState.Ready&&(e.gl.beginQuery(t.target,t.handle),t.state=e.QueryState.Active,t.result=null,!0)}function dd(e,t){return t.state===e.QueryState.Active&&(e.gl.endQuery(t.target),t.state=e.QueryState.Pending,!0)}function ed(e,t){return!!e.gl.getQueryObject(t.handle,e.gl.QUERY_RESULT_AVAILABLE)&&(t.result=e.gl.getQueryObject(t.handle,e.gl.QUERY_RESULT),t.state=e.QueryState.Ready,!0)}_c=bd;var fd={};const g=j("context");let gd=0;const hd=["name","pass","pipeline","uniforms","attributes","indices","count","instances","viewport","scissor"];function id(e){b(!e||"object"==typeof e,"pex-context: createContext requires opts argument to be null or an object");let t=null;(e=Object.assign({},{pixelRatio:1},e)).pixelRatio&&(e=Object.assign(e,{pixelRatio:Math.min(e.pixelRatio,window.devicePixelRatio)})),e&&e.gl?e&&e.gl&&(t=e.gl):t=lc(e),b(t,"pex-context: createContext failed");const r={maxColorAttachments:1,maxTextureImageUnits:t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxCubeMapTextureSize:t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),instancedArrays:!1,instancing:!1,elementIndexUint32:!!t.getExtension("OES_element_index_uint"),standardDerivatives:!!t.getExtension("OES_standard_derivatives"),depthTexture:!!t.getExtension("WEBGL_depth_texture"),shaderTextureLod:!!t.getExtension("EXT_shader_texture_lod"),textureFloat:!!t.getExtension("OES_texture_float"),textureFloatLinear:!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:!!t.getExtension("OES_texture_half_float_linear"),textureFilterAnisotropic:!!t.getExtension("EXT_texture_filter_anisotropic")};if(!t.HALF_FLOAT){const e=t.getExtension("OES_texture_half_float");e&&(t.HALF_FLOAT=e.HALF_FLOAT_OES)}if(!t.createQuery){const e=t.getExtension("EXT_disjoint_timer_query");e?(t.TIME_ELAPSED=e.TIME_ELAPSED_EXT,t.QUERY_RESULT_AVAILABLE=e.QUERY_RESULT_AVAILABLE_EXT,t.GPU_DISJOINT=e.GPU_DISJOINT_EXT,t.QUERY_RESULT=e.QUERY_RESULT_EXT,t.createQuery=e.createQueryEXT.bind(e),t.deleteQuery=e.deleteQueryEXT.bind(e),t.beginQuery=e.beginQueryEXT.bind(e),t.endQuery=e.endQueryEXT.bind(e),t.getQueryObject=e.getQueryObjectEXT.bind(e)):(t.TIME_ELAPSED="TIME_ELAPSED",t.QUERY_RESULT_AVAILABLE="QUERY_RESULT_AVAILABLE",t.GPU_DISJOINT="GPU_DISJOINT",t.QUERY_RESULT="QUERY_RESULT",t.createQuery=function(){return{}},t.deleteQuery=function(){},t.beginQuery=function(){},t.endQuery=function(){},t.getQueryObject=function(e,r){return r===t.QUERY_RESULT_AVAILABLE||(r===t.QUERY_RESULT?0:void 0)})}const a={One:t.ONE,Zero:t.ZERO,SrcAlpha:t.SRC_ALPHA,OneMinusSrcAlpha:t.ONE_MINUS_SRC_ALPHA,DstAlpha:t.DST_ALPHA,OneMinusDstAlpha:t.ONE_MINUS_DST_ALPHA,SrcColor:t.SRC_COLOR,OneMinusSrcColor:t.ONE_MINUS_SRC_COLOR,DstColor:t.DST_COLOR,OneMinusDstColor:t.ONE_MINUS_DST_COLOR},i={PositiveX:t.TEXTURE_CUBE_MAP_POSITIVE_X,NegativeX:t.TEXTURE_CUBE_MAP_NEGATIVE_X,PositiveY:t.TEXTURE_CUBE_MAP_POSITIVE_Y,NegativeY:t.TEXTURE_CUBE_MAP_NEGATIVE_Y,PositiveZ:t.TEXTURE_CUBE_MAP_POSITIVE_Z,NegativeZ:t.TEXTURE_CUBE_MAP_NEGATIVE_Z},s={Never:t.NEVER,Less:t.LESS,Equal:t.EQUAL,LessEqual:t.LEQUAL,Greater:t.GREATER,NotEqual:t.NOTEQUAL,GreaterEqual:t.GEQUAL,Always:t.ALWAYS},n={Float32:t.FLOAT,Uint8:t.UNSIGNED_BYTE,Uint16:t.UNSIGNED_SHORT,Uint32:t.UNSIGNED_INT},o={Front:t.FRONT,Back:t.BACK,FrontAndBack:t.FRONT_AND_BACK},l={Nearest:t.NEAREST,Linear:t.LINEAR,NearestMipmapNearest:t.NEAREST_MIPMAP_NEAREST,NearestMipmapLinear:t.NEAREST_MIPMAP_LINEAR,LinearMipmapNearest:t.LINEAR_MIPMAP_NEAREST,LinearMipmapLinear:t.LINEAR_MIPMAP_LINEAR},c={Points:t.POINTS,Lines:t.LINES,LineStrip:t.LINE_STRIP,Triangles:t.TRIANGLES,TriangleStrip:t.TRIANGLE_STRIP},u={StaticDraw:t.STATIC_DRAW,DynamicDraw:t.DYNAMIC_DRAW,StreamDraw:t.STREAM_DRAW},d={ClampToEdge:t.CLAMP_TO_EDGE,Repeat:t.REPEAT},p={TimeElapsed:t.TIME_ELAPSED},f={gl:t,BlendFactor:a,CubemapFace:i,DataType:n,DepthFunc:s,Face:o,Filter:l,PixelFormat:{RGBA8:"rgba8",RGBA32F:"rgba32f",RGBA16F:"rgba16f",R32F:"r32f",R16F:"r16f",Depth:"depth",Depth16:"depth16",Depth24:"depth24"},Encoding:{Linear:1,Gamma:2,SRGB:3,RGBM:4},Primitive:c,Usage:u,Wrap:d,QueryTarget:p,QueryState:{Ready:"ready",Active:"active",Pending:"pending"}},h={pass:{framebuffer:{target:t.FRAMEBUFFER,handle:null,width:t.drawingBufferWidth,height:t.drawingBufferHeight},clearColor:[0,0,0,1],clearDepth:1},pipeline:ma(f,{}),viewport:[0,0,t.drawingBufferWidth,t.drawingBufferHeight],scissor:null,count:0};if(t.drawElementsInstanced)r.instancedArrays=!0,r.instancing=!0;else{const e=t.getExtension("ANGLE_instanced_arrays");e?(t.drawElementsInstanced=e.drawElementsInstancedANGLE.bind(e),t.drawArraysInstanced=e.drawArraysInstancedANGLE.bind(e),t.vertexAttribDivisor=e.vertexAttribDivisorANGLE.bind(e),r.instancedArrays=!0,r.instancing=!0):(t.drawElementsInstanced=function(){throw new Error("gl.drawElementsInstanced not available. ANGLE_instanced_arrays not supported")},t.drawArraysInstanced=function(){throw new Error("gl.drawArraysInstanced not available. ANGLE_instanced_arrays not supported")},t.vertexAttribDivisor=function(){throw new Error("gl.vertexAttribDivisor not available. ANGLE_instanced_arrays not supported")})}if(t.drawBuffers)r.maxColorAttachments=t.getParameter("MAX_COLOR_ATTACHMENTS");else{const e=t.getExtension("WEBGL_draw_buffers");e?(t.drawBuffers=e.drawBuffersWEBGL.bind(e),r.maxColorAttachments=t.getParameter(e.MAX_COLOR_ATTACHMENTS_WEBGL)):t.drawBuffers=function(){throw new Error("WEBGL_draw_buffers not supported")}}return g("capabilities",r),Object.assign(f,{debugMode:!1,capabilities:r,debugCommands:[],resources:[],stats:[],queries:[],stack:[h],defaultState:h,pixelRatio:e.pixelRatio||1,state:{pass:{framebuffer:h.pass.framebuffer},pipeline:ma(f,{}),activeTextures:[],activeAttributes:[]},getGLString:function(e){let r="";for(let a in t)t[a]===e&&(r=a);return r||(r="UNDEFINED"),r},set:function(e){b(Ua,"changing resolution is not supported in Plask"),e.pixelRatio&&(this.updatePixelRatio=Math.min(e.pixelRatio,window.devicePixelRatio)),e.width&&(this.updateWidth=e.width),e.height&&(this.updateHeight=e.height)},debug:function(e){this.debugMode=e},checkError:function(){if(this.debugMode){var e=t.getError();if(e)throw this.debugMode=!1,Ua&&g("State",this.state.state),new Error(`GL error ${e} : ${this.getGLString(e)}`)}},resource:function(e){return e.id=e.class+"_"+gd++,this.stats[e.class]||(this.stats[e.class]={alive:0,total:0}),this.stats[e.class].alive++,this.stats[e.class].total++,this.resources.push(e),this.checkError(),e},texture2D:function(e){return g("texture2D",e),e.target=t.TEXTURE_2D,this.resource(cb(this,e))},textureCube:function(e){return g("textureCube",e),e.target=t.TEXTURE_CUBE_MAP,this.resource(cb(this,e))},framebuffer:function(e){return g("framebuffer",e),this.resource(Nc(this,e))},renderbuffer:function(e){return g("renderbuffer",e),this.resource(Pc(this,e))},vertexBuffer:function(e){return g("vertexBuffer",e),e.length&&(e={data:e}),e.target=t.ARRAY_BUFFER,this.resource(kb(this,e))},indexBuffer:function(e){return g("indexBuffer",e),e.length&&(e={data:e}),e.target=t.ELEMENT_ARRAY_BUFFER,this.resource(kb(this,e))},program:function(e){return g("program",e),this.resource(Wc(this,e))},pipeline:function(e){return g("pipeline",e),this.resource(ma(this,e))},pass:function(e){return g("pass",e,e.color?e.color.map(e=>e.texture?e.texture.info:e.info):""),this.resource(Rc(this,e))},query:function(e){return g("query",e),this.resource(_c(this,e))},beginQuery:function(e){b(!this.activeQuery,"Only one query can be active at the time"),e._begin(this,e)&&(this.activeQuery=e)},endQuery:function(e){e._end(this,e)&&(this.queries.push(e),this.activeQuery=null)},readPixels:function(e){const r=e.x||0,a=e.y||0,i=e.width,s=e.height,n=t.RGBA,o=t.UNSIGNED_BYTE;let l=null;return l=new Uint8Array(i*s*4),t.readPixels(r,a,i,s,n,o,l),l},update:function(e,t){this.debugMode&&g("update",{resource:e,opts:t}),e._update(this,e,t)},mergeCommands:function(e,t,r){const a=Object.assign({},e);if(r||(a.pass=Object.assign({},e.pass),a.pass.clearColor=void 0,a.pass.clearDepth=void 0),Object.assign(a,t),!t.viewport&&t.pass&&t.pass.opts.color){let e=null;t.pass.opts.color[0]&&(e=t.pass.opts.color[0].texture||t.pass.opts.color[0]),t.pass.opts.depth&&(e=t.pass.opts.depth.texture||t.pass.opts.depth),e&&(a.viewport=[0,0,e.width,e.height])}return a.uniforms=e.uniforms||t.uniforms?Object.assign({},e.uniforms,t.uniforms):null,a},applyPass:function(e){const t=this.gl,r=this.state;r.pass.id!==e.id&&(this.debugMode&&g("change framebuffer",r.pass.framebuffer,"->",e.framebuffer),r.pass=e,e.framebuffer._update&&this.update(e.framebuffer,e.opts),t.bindFramebuffer(e.framebuffer.target,e.framebuffer.handle),e.framebuffer.drawBuffers&&e.framebuffer.drawBuffers.length>1&&t.drawBuffers(e.framebuffer.drawBuffers));let a=0;void 0!==e.clearColor&&(this.debugMode&&g("clearing color",e.clearColor),a|=t.COLOR_BUFFER_BIT,t.clearColor(e.clearColor[0],e.clearColor[1],e.clearColor[2],e.clearColor[3])),void 0!==e.clearDepth&&(this.debugMode&&g("clearing depth",e.clearDepth),a|=t.DEPTH_BUFFER_BIT,r.depthWrite||(r.depthWrite=!0,t.depthMask(!0)),t.clearDepth(e.clearDepth)),a&&t.clear(a),this.checkError()},applyPipeline:function(e){const t=this.gl,r=this.state;e.depthWrite!==r.depthWrite&&(r.depthWrite=e.depthWrite,t.depthMask(r.depthWrite)),e.depthTest!==r.depthTest&&(r.depthTest=e.depthTest,r.depthTest?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)),e.depthFunc!==r.depthFunc&&(r.depthFunc=e.depthFunc,t.depthFunc(r.depthFunc)),e.blend===r.blend&&e.blendSrcRGBFactor===r.blendSrcRGBFactor&&e.blendSrcAlphaFactor===r.blendSrcAlphaFactor&&e.blendDstRGBFactor===r.blendDstRGBFactor&&e.blendDstAlphaFactor===r.blendDstAlphaFactor||(r.blend=e.blend,r.blendSrcRGBFactor=e.blendSrcRGBFactor,r.blendSrcAlphaFactor=e.blendSrcAlphaFactor,r.blendDstRGBFactor=e.blendDstRGBFactor,r.blendDstAlphaFactor=e.blendDstAlphaFactor,r.blend?t.enable(t.BLEND):t.disable(t.BLEND),t.blendFuncSeparate(r.blendSrcRGBFactor,r.blendDstRGBFactor,r.blendSrcAlphaFactor,r.blendDstAlphaFactor)),e.cullFace===r.cullFace&&e.cullFaceMode===r.cullFaceMode||(r.cullFace=e.cullFace,r.cullFaceMode=e.cullFaceMode,r.cullFace?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),r.cullFace&&t.cullFace(r.cullFaceMode)),e.colorMask[0]===r.pipeline.colorMask[0]&&e.colorMask[1]===r.pipeline.colorMask[1]&&e.colorMask[2]===r.pipeline.colorMask[2]&&e.colorMask[3]===r.pipeline.colorMask[3]||(r.pipeline.colorMask[0]=e.colorMask[0],r.pipeline.colorMask[1]=e.colorMask[1],r.pipeline.colorMask[2]=e.colorMask[2],r.pipeline.colorMask[3]=e.colorMask[3],t.colorMask(e.colorMask[0],e.colorMask[1],e.colorMask[2],e.colorMask[3])),e.program!==r.program&&(r.program=e.program,r.program&&t.useProgram(r.program.handle)),e.vertexLayout&&(r.vertexLayout=e.vertexLayout),this.checkError()},applyUniforms:function(e,t){const r=this.gl,a=this.state;let i=0;a.program||b.fail("Trying to draw without an active program");const s=this.debugMode?Object.keys(a.program.uniforms):null;for(var n in e){let c=e[n];if(a.program.uniforms[n]||a.program.uniforms[n+"[0]"])if(null==c&&(g("invalid command",t),b.fail(`Can't set uniform "${n}" with a null value`)),Array.isArray(c)&&!a.program.uniforms[n]){this.debugMode&&g("unknown uniform",n,Object.keys(a.program.uniforms));for(var o=0;o<c.length;o++){var l=n+"["+o+"]";a.program.setUniform(l,c[o]),this.debugMode&&s.splice(s.indexOf(l),1)}}else if(c.target){const e=i++;r.activeTexture(r.TEXTURE0+e),a.activeTextures[e]!==c&&(r.bindTexture(c.target,c.handle),a.activeTextures[e]=c),a.program.setUniform(n,e),this.debugMode&&s.splice(s.indexOf(n),1)}else c.length||"object"!=typeof c?(a.program.setUniform(n,c),this.debugMode&&s.splice(s.indexOf(n),1)):(g("invalid command",t),b.fail(`Can set uniform "${n}" with an Object value`))}this.debugMode&&s.length>0&&(g("invalid command",t),b.fail(`Trying to draw with missing uniforms: ${s.join(", ")}`)),this.checkError()},drawVertexData:function(e){const a=this.state,i=a.vertexLayout;a.program||b.fail("Trying to draw without an active program"),this.debugMode&&i.length!==Object.keys(a.program.attributes).length&&(g("Invalid vertex layout not matching the shader",i,a.program.attributes,e),b.fail("Invalid vertex layout not matching the shader"));let s=!1;for(let r=0;r<16;r++)a.activeAttributes[r]=null,t.disableVertexAttribArray(r);for(let u=0;u<i.length;u++){const n=i[u],o=n[0],l=n[1],c=n[2],d=e.attributes[u]||e.attributes[o];d||(g("Invalid command",e,"doesn't satisfy vertex layout",i),b.fail(`Command is missing attribute "${o}" at location ${l} with ${d}`));let p=d.buffer;p||"vertexBuffer"!==d.class||(p=d),p&&p.target||(g("Invalid command",e),b.fail(`Trying to draw arrays with invalid buffer for attribute : ${o}`)),t.bindBuffer(p.target,p.handle),16===c?(t.enableVertexAttribArray(l+0),t.enableVertexAttribArray(l+1),t.enableVertexAttribArray(l+2),t.enableVertexAttribArray(l+3),a.activeAttributes[l+0]=p,a.activeAttributes[l+1]=p,a.activeAttributes[l+2]=p,a.activeAttributes[l+3]=p,t.vertexAttribPointer(l,4,d.type||p.type,d.normalized||!1,d.stride||64,d.offset||0),t.vertexAttribPointer(l+1,4,d.type||p.type,d.normalized||!1,d.stride||64,d.offset||16),t.vertexAttribPointer(l+2,4,d.type||p.type,d.normalized||!1,d.stride||64,d.offset||32),t.vertexAttribPointer(l+3,4,d.type||p.type,d.normalized||!1,d.stride||64,d.offset||48),d.divisor?(t.vertexAttribDivisor(l+0,d.divisor),t.vertexAttribDivisor(l+1,d.divisor),t.vertexAttribDivisor(l+2,d.divisor),t.vertexAttribDivisor(l+3,d.divisor),s=!0):r.instancing&&(t.vertexAttribDivisor(l+0,0),t.vertexAttribDivisor(l+1,0),t.vertexAttribDivisor(l+2,0),t.vertexAttribDivisor(l+3,0))):(t.enableVertexAttribArray(l),a.activeAttributes[l]=p,t.vertexAttribPointer(l,c,d.type||p.type,d.normalized||!1,d.stride||0,d.offset||0),d.divisor?(t.vertexAttribDivisor(l,d.divisor),s=!0):r.instancing&&t.vertexAttribDivisor(l,0))}let n=e.pipeline.primitive;if(e.indices){let r=e.indices.buffer;r||"indexBuffer"!==e.indices.class||(r=e.indices),r&&r.target||(g("Invalid command",e),b.fail("Trying to draw arrays with invalid buffer for elements")),a.indexBuffer=r,t.bindBuffer(r.target,r.handle);var o=e.count||r.length,l=e.indices.offset||0,c=e.indices.type||r.type;s?t.drawElementsInstanced(n,o,c,l,e.instances):t.drawElements(n,o,c,l)}else if(e.count){const r=0;s?t.drawArraysInstanced(n,r,e.count,e.instances):t.drawArrays(n,r,e.count)}else b.fail("Vertex arrays requres elements or count to draw");this.checkError()},frame:function(e){const r=this;ja(function a(){r.updatePixelRatio&&(r.pixelRatio=r.updatePixelRatio,r.updateWidth||(r.updateWidth=parseInt(t.canvas.style.width)||t.canvas.width),r.updateHeight||(r.updateHeight=parseInt(t.canvas.style.height)||t.canvas.height),r.updatePixelRatio=0),r.updateWidth&&(t.canvas.style.width=r.updateWidth+"px",t.canvas.width=r.updateWidth*r.pixelRatio,r.updateWidth=0),r.updateHeight&&(t.canvas.style.height=r.updateHeight+"px",t.canvas.height=r.updateHeight*r.pixelRatio,r.updateHeight=0),r.defaultState.viewport[2]===t.drawingBufferWidth&&r.defaultState.viewport[3]===t.drawingBufferHeight||(r.defaultState.viewport[2]=t.drawingBufferWidth,r.defaultState.viewport[3]=t.drawingBufferHeight,r.defaultState.pass.framebuffer.width=t.drawingBufferWidth,r.defaultState.pass.framebuffer.height=t.drawingBufferHeight,t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight)),!1!==e()&&(r.queries.length&&(r.queries=r.queries.filter(e=>!e._available(r,e))),ja(a))})},apply:function(e){const r=this.state;this.debugMode&&g("apply",e.name||e.id,{cmd:e,state:JSON.parse(JSON.stringify(r))}),this.checkError(),e.scissor?e.scissor!==r.scissor&&(r.scissor=e.scissor,t.enable(t.SCISSOR_TEST),t.scissor(r.scissor[0],r.scissor[1],r.scissor[2],r.scissor[3])):e.scissor!==r.scissor&&(r.scissor=e.scissor,t.disable(t.SCISSOR_TEST)),e.pass&&this.applyPass(e.pass),e.pipeline&&this.applyPipeline(e.pipeline),e.uniforms&&this.applyUniforms(e.uniforms),e.viewport&&e.viewport!==r.viewport&&(r.viewport=e.viewport,t.viewport(r.viewport[0],r.viewport[1],r.viewport[2],r.viewport[3])),e.attributes&&this.drawVertexData(e)},submit:function(e,t,r){if(this.debugMode&&(this.debugCommands.push(e),v(hd,e),g("submit",e.name||e.id,t&&r?{depth:this.stack.length,cmd:e,batches:t,subCommand:r,state:this.state,stack:this.stack}:t?{depth:this.stack.length,cmd:e,batches:t,state:this.state,stack:this.stack}:{depth:this.stack.length,cmd:e,state:this.state,stack:this.stack})),t){if(Array.isArray(t)){for(let a=0;a<t.length;a++){const i=t[a];this.submit(this.mergeCommands(e,i,!0),r)}return}if("object"==typeof t)return void this.submit(this.mergeCommands(e,t,!0),r);r=t}const a=this.stack[this.stack.length-1],i=this.mergeCommands(a,e,!1);if(this.apply(i),r){if(this.debugMode&&(this.debugGraph+=`subgraph cluster_${e.name||e.id} {\n`,this.debugGraph+=`label = "${e.name}"\n`,e.program&&(this.debugGraph+=`${e.program.id} -> cluster_${e.name||e.id}\n`),e.framebuffer)){this.debugGraph+=`${e.framebuffer.id} -> cluster_${e.name||e.id}\n`;for(let t=0;t<e.framebuffer.color;t++){const r=e.framebuffer.color[t];this.debugGraph+=`${r.texture.id} -> ${e.framebuffer.id}\n`}e.framebuffer.depth&&(this.debugGraph+=`${e.framebuffer.depth.texture.id} -> ${e.framebuffer.id}\n`)}this.stack.push(i),r(),this.stack.pop(),this.debugMode&&(this.debugGraph+="}\n")}else if(this.debugMode){let t=`${e.name||e.id} [style=filled fillcolor = "#DDFFDD" label="`,r=[e.name||e.id];if(e.uniforms){r.push(" "),r.push("uniforms");const t=Object.keys(e.uniforms);for(let a=0;a<t.length;a++){const i=t[a];r.push(`<u${a}>${i}`);const s=e.uniforms[i];null==s&&(g("Invalid command",e),b.fail(`Trying to draw with uniform "${i}" = null`)),s.id&&(this.debugGraph+=`${s.id} -> ${e.name||e.id}:u${a}\n`)}}t+=r.join("|"),t+="\"]",this.debugGraph+=`${t}\n`}this.checkError()},dispose:function(e){if(g("dispose",e),b(e||0===arguments.length,"Trying to dispose undefined resource"),e){e._dispose||b(e._dispose,"Trying to dispose non resource");const t=this.resources.indexOf(e);b(-1!==t,"Trying to dispose resource from another context"),this.resources.splice(t,1),this.stats[e.class].alive--,e._dispose()}else{for(;this.resources.length;)this.dispose(this.resources[0]);this.gl.canvas.width=1,this.gl.canvas.height=1}}}),f.apply(h),f}fd=id;function jd(t,e){return md(t)||ld(t,e)||kd()}function kd(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function ld(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var i=[],n=!0,a=!1,o=void 0;try{for(var s,r=t[Symbol.iterator]();!(n=(s=r.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(h){a=!0,o=h}finally{try{n||null==r.return||r.return()}finally{if(a)throw o}}return i}}function md(t){if(Array.isArray(t))return t}function nd(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function nb(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function od(t,e,i){return e&&nb(t.prototype,e),i&&nb(t,i),t}var ob=["webgl2","webgl","experimental-webgl"];function pd(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.context,r=e.canvas,n=e.options,o=r||null;o instanceof HTMLCanvasElement==!1&&(o=qd(r||{}));var a=null;if(t&&(a=o.getContext(t,n)),!a){t&&console.warn("The provided context is unavailable");for(var v=0;v<ob.length;v++){var i=o.getContext(ob[v],n);if(i){a=i;break}}}if(null===a)throw new Error("WebGL is unavailable");return a}function qd(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.width,r=void 0===t?window.innerHeight:t,n=e.height,o=void 0===n?window.innerWidth:n,a=e.pixelRatio,v=void 0===a?window.devicePixelRatio:a,i=e.append,$=void 0===i||i,c=document.createElement("canvas");return 1!==v&&(c.style.width=r+"px",c.style.height=o+"px"),c.width=r*v,c.height=o*v,$&&document.body.appendChild(c),c}function rd(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&["WEBGL_debug_renderer_info","WEBGL_debug_shaders"].forEach(function(t){e.getExtension(t)||console.warn("Failed to load WebGL debug extension \"".concat(t,"\""))})}function pb(t,e){return ud(t)||td(t,e)||sd()}function sd(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function td(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var r=[],n=!0,o=!1,i=void 0;try{for(var a,$=t[Symbol.iterator]();!(n=(a=$.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(l){o=!0,i=l}finally{try{n||null==$.return||$.return()}finally{if(o)throw i}}return r}}function ud(t){if(Array.isArray(t))return t}function vd(t,e){if(null==t)return{};var r,n,o=wd(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(o[r]=t[r])}return o}function wd(t,e){if(null==t)return{};var r,n,o={},i=Object.keys(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||(o[r]=t[r]);return o}function xd(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.width,r=void 0===e?window.innerHeight:e,n=t.height,o=void 0===n?window.innerWidth:n,i=t.pixelRatio,a=void 0===i?window.devicePixelRatio:i,$=t.canvas,l=void 0===$?null:$,c=t.append,u=void 0===c?!(l instanceof HTMLCanvasElement):c,v=l||document.createElement("canvas");return 1!==a&&(v.style.width=r+"px",v.style.height=o+"px"),v.width=r*a,v.height=o*a,u&&document.body.appendChild(v),v}function yd(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.append,r=void 0===e||e,n=vd(t,["append"]),o=[["width","device-width"],["user-scalable","no"],["minimum-scale","1.0"],["maximum-scale","1.0"],["shrink-to-fit","0.0"]].filter(function(t){var e=pb(t,2),r=e[0];return!!e[1]||!!n[r]}).map(function(t){var e=pb(t,2),r=e[0],o=e[1];return[r,n[r]||o].join("=")}).join(", "),i=document.createElement("meta");return i.setAttribute("name","viewport"),i.setAttribute("content",o),r&&document.head.appendChild(i),i}var o={};function qb(t){return new Error("Event handler for ".concat(t," is not a function"))}function zd(t){return new Error("Event ".concat(t," is not supported"))}var k=new Map;o.events=k;var na=new Map;o.eventHandlers=na;var rb=new Set(["error","message","resize","mousemove","mousedown","mouseup","touchstart","touchend","touchmove","touchcancel","devicemotion","deviceorientation"]);o.enabledEvents=rb;var oa=!0;function pa(e,t,$,n){if("function"!=typeof t)throw qb(e);if(!rb.has(e))throw zd(e);if(k.has(e)){k.get(e).add(t)}else{k.set(e,new Set([t]));var o=function(t){k.has(e)?k.get(e).forEach(function(e){return e(t)}):$[eventKey]=null};if(oa)na.set(e,o),$.addEventListener(e,o,n);else{var B="on".concat(e);B in $&&($[B]=o)}}}function sb(e,t,$){if(k.has(e)){var n=k.get(e);if(n.delete(t),0===n.size){if(oa){var o=na.get(e);$.addEventListener(e,o)}else{var B="on".concat(e);"function"==typeof $[B]&&($[B]=null)}k.delete(e)}}}function Ad(e,t,$){if("function"!=typeof t)throw qb(e);pa(e,function n(o){sb(e,n,$),t(o)},$)}function Bd(e,t){k.has(e)&&k.get(e).forEach(function(e){return e(t)})}o.useEventListener=oa,o.on=pa,o.off=sb,o.once=Ad,o.emit=Bd;var Cd=function(){function t(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).debug,i=void 0!==e&&e;nd(this,t),this._debug=i,this.events=o,this.state={time:0,ticks:0,alpha:0,beta:0,gamma:0,mx:0,my:0,dragging:!1}}return od(t,[{key:"initialize",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.debug,n=void 0===i||i,a=e.width,o=void 0===a?this.width:a,s=e.height,r=void 0===s?this.height:s,h=e.pixelRatio,u=void 0===h?this.pixelRatio:h,c=e.context,l=void 0===c?"webgl":c,v=e.canvas,d=void 0===v?null:v,$=e.events,f=void 0===$?{mouse:!0,touch:!0,device:!1}:$;this.canvas=xd({width:o,height:r,pixelRatio:u,canvas:d}),yd({append:!0}),this.gl=pd({context:l,canvas:this.canvas,options:this.options.gl}),this.availableExtensions=this.gl.getSupportedExtensions(),rd(this.gl,n),["render","stop","set"].forEach(function(e){t[e]=t[e].bind(t)});var p=[["resize","onResize",window]];return f.device&&p.push(["devicemotion","onDeviceMotion",window],["deviceorientation","onDeviceOrientation",window]),f.mouse&&p.push(["mousemove","onMouseMove",this.canvas],["mousedown","onMouseDown",this.canvas],["mouseup","onMouseUp",this.canvas]),f.touch&&p.push(["touchmove","onTouchMove",this.canvas],["touchstart","onTouchStart",this.canvas],["touchend","onTouchEnd",this.canvas],["touchcancel","onTouchCancel",this.canvas]),p.forEach(function(e){var i=jd(e,3),n=i[0],a=i[1],o=i[2];t[a]=t[a].bind(t),pa(n,t[a],o,!0)}),this.initialized=!0,this}},{key:"render",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.modules=[],this.ctx=t,[].concat(e).map(function e(i){var n=i(t,this);"function"==typeof n?this.modules.push(n):Array.isArray(n)&&n.forEach(e.bind(this))}.bind(this));var i=performance.now(),n=this;return this.raf=window.requestAnimationFrame(function t(){n.state.ticks+=1,n.state.time=(performance.now()-i)/1e3,n.modules.forEach(function(t){return t(n.state)}),window.requestAnimationFrame(t)}),this}},{key:"stop",value:function(){return window.cancelAnimationFrame(this.raf),this}},{key:"destroy",value:function(){}},{key:"set",value:function(t,e){return["options"].includes(t)&&(this["_".concat(t)]=e),this}},{key:"onResize",value:function(){var t=this.width,e=this.height,i=this.pixelRatio;this.ctx&&this.ctx.set({width:t,height:e,pixelRatio:i})}},{key:"onDeviceMotion",value:function(){}},{key:"onDeviceOrientation",value:function(t){var e=t.alpha,i=t.beta,n=t.gamma;this.state.alpha=e,this.state.beta=i,this.state.gamma=n}},{key:"onMouseMove",value:function(t){this.mx=t.offsetX,this.my=t.offsetY,this.state.dragging&&(this.state.mx=this.mx/this.width,this.state.my=1-this.my/this.height)}},{key:"onMouseDown",value:function(t){this.state.dragging=!0,this.state.mx=this.mx,this.state.my=this.my}},{key:"onMouseUp",value:function(t){this.state.dragging=!1,this.state.dx=0,this.state.dy=0}},{key:"onTouchMove",value:function(t){t.preventDefault(),t.stopPropagation();var e=t.touches[0],i=e.clientX,n=e.clientY,a=e.force;this.mx=i,this.my=n,this.state.force=a,this.state.dragging&&(this.state.mx=this.mx/this.width,this.state.my=1-this.my/this.height)}},{key:"onTouchStart",value:function(t){t.preventDefault(),t.stopPropagation(),this.state.dragging=!0,this.state.dx=0,this.state.dy=0}},{key:"onTouchEnd",value:function(t){t.preventDefault(),t.stopPropagation(),this.state.dragging=!1}},{key:"onTouchCancel",value:function(t){t.preventDefault(),t.stopPropagation(),this.state.dragging=!1}},{key:"width",get:function(){return window.innerWidth}},{key:"height",get:function(){return window.innerHeight}},{key:"pixelRatio",get:function(){return window.devicePixelRatio}},{key:"options",get:function(){return this._options||{}}}]),t}();var Dd={debug:!0,workers:!0,sharedBuffers:!0},qa=new Cd(Dd);function h(r){for(var x=arguments.length,$=new Array(x>1?x-1:0),o=1;o<x;o++)$[o-1]=arguments[o];var t=[];return r.forEach(function(r,x){t.push(r,$[x])}),t.join("").trim()}var Ed=[[-1,-1],[1,-1],[1,1],[-1,1]],Fd=[[0,0],[1,0],[1,1],[0,1]],Gd=[[0,1,2],[0,2,3]],Hd=[[0,0,1],[0,0,1]],ra={positions:Ed,texCoords:Fd,faces:Gd,normals:Hd};function Id(){var e=tb(["\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vTexCoord;\n\n    uniform sampler2D uTexture;\n\n    void main() {\n      gl_FragColor = texture2D(uTexture, vTexCoord);\n    }\n  "]);return Id=function(){return e},e}function Jd(){var e=tb(["\n    attribute vec2 aPosition;\n    attribute vec2 aTexCoord;\n\n    varying vec2 vTexCoord;\n\n    void main() {\n      vTexCoord = aTexCoord;\n\n      gl_Position = vec4(aPosition, 0.0, 1.0);\n    }\n  "]);return Jd=function(){return e},e}function tb(e,r){return r||(r=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(r)}}))}var q=h(Jd());var Kd=h(Id());function Ld(){var e=ub(["\n  precision highp float;\n\n  uniform sampler2D uVideoTexture;\n  uniform vec4 uBounds;\n  uniform float uColorFactor;\n\n  varying vec2 vTexCoord;\n\n  vec4 convertToGeyScale(vec4 sample) {\n    float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n    return vec4(\n      sample.r * uColorFactor + grey * (1.0 - uColorFactor),\n      sample.g * uColorFactor + grey * (1.0 - uColorFactor),\n      sample.b * uColorFactor + grey * (1.0 - uColorFactor),\n      1.0\n    );\n  }\n\n  float divisor = 1. / 3.;\n  const int octaves = 4;\n  int threshold = 9;\n\n  void main() {\n    vec4 sample = texture2D(uVideoTexture, vTexCoord);\n\n    if (vTexCoord.y <= divisor * 2. && vTexCoord.y >= divisor) {\n      gl_FragColor = convertToGeyScale(sample);\n    } else if (vTexCoord.y < divisor) {\n      vec4 grey = convertToGeyScale(sample);\n\n      int n = 0;\n      float radius = 4.;\n      const int steps = 360 / 16;\n\n      for (int i = 0; i < steps; i++) {\n        int theta = i * steps;\n        vec4 pix = texture2D(\n          uVideoTexture,\n          vec2(\n            floor(radius * cos(float(theta))),\n            floor(radius * sin(float(theta)))\n          )\n        );\n\n        if (length(abs(grey - convertToGeyScale(pix))) > 0.85) {\n          n++;\n        }\n      }\n\n      if (n > threshold) {\n        gl_FragColor = vec4(1.);\n      } else {\n        gl_FragColor = vec4(vec3(0.), 1.);\n      }\n    } else {\n      gl_FragColor = sample;\n    }\n  }"]);return Ld=function(){return e},e}function Md(){var e=ub(["\n  attribute vec2 aPosition;\n  attribute vec2 aTexCoord0;\n\n  uniform vec4 uBounds; // x, y, width, height\n\n  varying vec2 vTexCoord;\n\n  void main() {\n    vec2 pos = aPosition;\n    pos = (pos + 1.0) / 2.0; // move from -1..1 to 0..1\n    pos = vec2(\n      uBounds.x + pos.x * uBounds.z,\n      uBounds.y + pos.y * uBounds.w\n    );\n    pos = pos * 2.0 - 1.0;\n    gl_Position = vec4(pos, 0.0, 1.0);\n    vTexCoord = aTexCoord0;\n  }"]);return Md=function(){return e},e}function ub(e,o){return o||(o=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(o)}}))}var Ce=h(Md());var De=h(Ld());function Nd(){var e=vb(["\n  precision highp float;\n\n  varying vec2 vTexCoord0;\n\n  uniform sampler2D uTexture;\n\n  void main() {\n    gl_FragColor = texture2D(uTexture, vTexCoord0);\n  }"]);return Nd=function(){return e},e}function Od(){var e=vb(["\n  attribute vec2 aPosition;\n  attribute vec2 aTexCoord0;\n\n  varying vec2 vTexCoord0;\n\n  void main() {\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n    vTexCoord0 = aTexCoord0;\n  }"]);return Od=function(){return e},e}function vb(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var Ee=h(Od());var Fe=h(Nd());function Pd(){var e=wb(["\n  precision mediump float;\n  varying vec3 vNormal;\n  void main () {\n    gl_FragColor = vec4(vNormal * 0.5 + 0.5, 1.0);\n  }"]);return Pd=function(){return e},e}function Qd(){var e=wb(["\n  attribute vec3 aPosition;\n  attribute vec3 aNormal;\n\n  uniform mat4 uProjectionMatrix;\n  uniform mat4 uViewMatrix;\n\n  varying vec3 vNormal;\n\n  void main () {\n    gl_Position = uProjectionMatrix * uViewMatrix * vec4(aPosition, 1.0);\n    vNormal = aNormal;\n  }"]);return Qd=function(){return e},e}function wb(e,r){return r||(r=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(r)}}))}var Ge=h(Qd());var He=h(Pd());function Rd(){var e=xb(["\n  precision highp float;\n\n  uniform vec2 uMouse;\n  uniform vec2 uResolution;\n  uniform sampler2D uScreenTexture;\n\n  vec4 advect(sampler2D map, vec2 center) {\n    return vec4(0.);\n  }\n\n  void main() {\n    vec2 pixel = gl_FragCoord.xy / uResolution.xy;\n\n    // grab the current pixel\n    gl_FragColor = texture2D( uScreenTexture, pixel );\n\n    float dist = distance(uMouse.xy, gl_FragCoord.xy);\n\n    float radius = 20.;\n    if (dist < radius) {\n      float factor = 1. - (dist / radius);\n      float base = 0.05 * (factor * 4.);\n      gl_FragColor.rgb += base;\n    } else {\n      // simulate smoke going up\n      float xPixel = 1.0/uResolution.x;\n      float yPixel = 1.0/uResolution.y;\n\n      vec4 rightColor = texture2D(uScreenTexture, vec2(pixel.x+xPixel, pixel.y));\n      vec4 leftColor = texture2D(uScreenTexture, vec2(pixel.x-xPixel, pixel.y));\n      vec4 upColor = texture2D(uScreenTexture, vec2(pixel.x, pixel.y+yPixel));\n      vec4 downColor = texture2D(uScreenTexture, vec2(pixel.x, pixel.y-yPixel));\n\n      // diffusion\n      gl_FragColor.rgb +=\n        8.0 * 0.016 *\n        (\n            leftColor.rgb +\n            rightColor.rgb +\n            downColor.rgb * 3.0 +\n            upColor.rgb -\n            6.0 * gl_FragColor.rgb\n        );\n      // gl_FragColor.rgb +=\n      //   12.0 * 0.016 *\n      //   (\n      //       leftColor.rgb +\n      //       rightColor.rgb +\n      //       downColor.rgb * 3.0 +\n      //       upColor.rgb -\n      //       4.0 * gl_FragColor.rgb\n      //   );\n    }\n\n    gl_FragColor.a = 1.0;\n  }"]);return Rd=function(){return e},e}function Sd(){var e=xb(["\n  attribute vec2 aPosition;\n\n  void main() {\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n  }"]);return Sd=function(){return e},e}function xb(e,r){return r||(r=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(r)}}))}var Ie=h(Sd()),Je=h(Rd());function Td(r,e){return Wd(r)||Vd(r,e)||Ud()}function Ud(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function Vd(r,e){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r)){var t=[],n=!0,i=!1,a=void 0;try{for(var o,$=r[Symbol.iterator]();!(n=(o=$.next()).done)&&(t.push(o.value),!e||t.length!==e);n=!0);}catch(p){i=!0,a=p}finally{try{n||null==$.return||$.return()}finally{if(i)throw a}}return t}}function Wd(r){if(Array.isArray(r))return r}function Xd(r,e){var t={gridSize:1024,gridUnit:1/1024,timestep:1/120,jacobiIterations:10,density:1},n=ra.positions,i=ra.texCoords,a=ra.faces,o=r.indexBuffer(a),$={aPosition:r.vertexBuffer(n),aTexCoord:r.vertexBuffer(i)},p={height:e.height,width:e.width,pixelFormat:r.PixelFormat.RGBA8,encoding:r.Encoding.SRGB},s={height:t.gridSize,width:t.gridSize,pixelFormat:r.PixelFormat.RGBA8,encoding:r.Encoding.SRGB};Td(["OES_texture_float"].map(function(e){return!!r.gl.getExtension(e)||(console.warn("".concat(e," is not supported")),!1)}),1)[0]&&(s.pixelFormat=r.PixelFormat.RGBA32F);var u={color1:r.texture2D(p),color2:r.texture2D(p),velocity1:r.texture2D(s),velocity2:r.texture2D(s),divergence:r.texture2D(s),pressure1:r.texture2D(s),pressure2:r.texture2D(s)};e.state.water={indices:o,attributes:$,parameters:t,textures:u,swap:function(r,e){var t=u[r];u[r]=u[e],u[e]=t}};var c=[ge,je,me],l=[re,ue,xe];return[Yd].concat(c,l)}function Yd(e,r){var t=r.state.water,a=t.indices,s=t.attributes,i=t.textures.color1,u={pass:e.pass({clearColor:[.2,.2,.2,1]}),pipeline:e.pipeline({vert:q,frag:Kd}),attributes:s,indices:a,uniforms:{uTexture:i}};return function(){var t=r.state.water;e.submit(u,{uniforms:{uTexture:t.textures.color1}})}}function Zd(){var e=$d(["\n  precision highp float;\n  precision highp sampler2D;\n\n  varying vec2 vTexCoord;\n\n  uniform float uTimeStep;\n\n  uniform sampler2D uInputTexture;\n  uniform sampler2D uSamplingTexture;\n\n  void main() {\n    vec2 u = texture2D(uSamplingTexture, fract(vTexCoord)).xy;\n    vec2 pastCoord = fract(vTexCoord - (0.5 * uTimeStep * u));\n    gl_FragColor = texture2D(uInputTexture, pastCoord);\n  }"]);return Zd=function(){return e},e}function $d(e,r){return r||(r=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(r)}}))}var _d=h(Zd());function ae(){var e=yb(["\n    #define MAX_LEVEL 10;\n    #define PI 333.0/106.0;\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vTexCoord;\n\n    uniform highp float uGridUnit;\n    uniform float uGridSize;\n    uniform sampler2D uInputTexture;\n\n    vec2 BOX(vec2 velocity, float min, float max) {\n      if (vTexCoord.x > min && vTexCoord.x < max) {\n        if (vTexCoord.y > min && vTexCoord.y < max) {\n          return vec2(0.0, 0.0);\n        }\n      }\n    }\n\n    vec2 Ramp(vec2 velocity, float limits) {\n      float dist = distance(vTexCoord, vec2(limits));\n\n      return velocity.xy *= (dist * .5 + .5);\n    }\n\n    void main() {\n      vec4 velocity = texture2D(uInputTexture, vTexCoord);\n\n      float nX = vTexCoord.x;\n      float nY = vTexCoord.y;\n      float bound = 6.;\n      float limits = uGridUnit * bound;\n\n      if (nX <= limits || nX >= 1. - limits || nY <= limits || nY >= 1. - limits) {\n        // velocity.xy = Ramp(velocity.xy, limits);\n        velocity.xy = vec2(0.);\n      }\n\n      gl_FragColor = velocity;\n    }"]);return ae=function(){return e},e}function be(e,t){return ee(e)||de(e,t)||ce()}function ce(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function de(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var r=[],i=!0,n=!1,o=void 0;try{for(var a,l=e[Symbol.iterator]();!(i=(a=l.next()).done)&&(r.push(a.value),!t||r.length!==t);i=!0);}catch(u){n=!0,o=u}finally{try{i||null==l.return||l.return()}finally{if(n)throw o}}return r}}function ee(e){if(Array.isArray(e))return e}function fe(){var e=yb(["\n    precision highp float;\n\n    varying vec2 vTexCoord;\n\n    uniform float uFactor;\n\n    void main() {\n      float x = 1.0 - fract(cos(vTexCoord.x * uFactor));\n      float y = 1.0 - fract(sin(vTexCoord.y * uFactor));\n\n      gl_FragColor = vec4(vec3(x, y, 0.), 1.0);\n    }"]);return fe=function(){return e},e}function yb(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function ge(e,t){var r=t.state.water,i=r.indices,n=r.attributes,o=r.parameters,a=o.timestep,l=o.gridSize,u=o.gridUnit,c=r.textures,s=c.velocity1,v=c.velocity2,$=r.swap,d={pass:e.pass({color:[v]}),pipeline:e.pipeline({vert:q,frag:_d}),attributes:n,indices:i,uniforms:{uTimeStep:a,uInputTexture:s,uSamplingTexture:s}},p=h(fe()),m={pipeline:e.pipeline({vert:q,frag:p}),attributes:n,indices:i};[].forEach(function(t){var r=be(t,2),i=r[0],n=r[1];e.submit(m,{pass:e.pass({color:[i]}),uniforms:{uFactor:n}})});var f=h(ae()),x={pass:e.pass({color:[s]}),pipeline:e.pipeline({vert:q,frag:f}),attributes:n,indices:i,uniforms:{uGridUnit:u,uGridSize:l,uInputTexture:v}};return function(){var r=t.state.water;e.submit(d,{pass:e.pass({color:[r.textures.velocity2]}),uniforms:{uInputTexture:r.textures.velocity1,uSamplingTexture:r.textures.velocity1}}),$("velocity1","velocity2"),e.submit(x,{pass:e.pass({color:[r.textures.velocity2]}),uniforms:{uInputTexture:r.textures.velocity1}}),$("velocity1","velocity2")}}function he(){var e=ie(["\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vTexCoord;\n\n    uniform float uTimeStep;\n    uniform float uDensity;\n    uniform float uGridUnit;\n\n    uniform sampler2D uVelocityTexture;\n\n    vec2 u(vec2 coord) {\n      return texture2D(uVelocityTexture, fract(coord)).xy;\n    }\n\n    void main() {\n      vec2 unit = vec2(0.0, uGridUnit);\n      float dx = u( vTexCoord + unit.yx ).x - u( vTexCoord - unit.yx ).x;\n      float dy = u( vTexCoord + unit.xy ).y - u( vTexCoord - unit.xy ).y;\n      float divergence = ( -2.0 * uGridUnit * uDensity / uTimeStep ) * ( dx + dy );\n\n      gl_FragColor = vec4(divergence, 0., 0., 0.);\n    }"]);return he=function(){return e},e}function ie(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function je(e,t){var r=t.state.water,i=r.indices,n=r.attributes,u=r.parameters,o=u.timestep,a=u.density,c=u.gridUnit,d=r.textures,l=d.velocity1,s=d.divergence,$=h(he()),p={pass:e.pass({color:[s]}),pipeline:e.pipeline({vert:q,frag:$}),attributes:n,indices:i,uniforms:{uTimeStep:o,uDensity:a,uGridUnit:c,uVelocityTexture:l}};return function(){e.submit(p,{uniforms:{uVelocityTexture:t.state.water.textures.velocity1}})}}function ke(){var e=zb(["\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vTexCoord;\n\n    uniform float uTimeStep;\n    uniform float uDensity;\n    uniform float uGridUnit;\n    uniform sampler2D uVelocityTexture;\n    uniform sampler2D uPressureTexture;\n\n    float p(vec2 coord) {\n      return texture2D(uPressureTexture, fract(coord)).x;\n    }\n\n    void main() {\n      vec2 unit = vec2(0, uGridUnit);\n\n      float right = p(vTexCoord +unit.yx);\n      float left = p(vTexCoord -unit.yx);\n      float top = p(vTexCoord + unit.xy);\n      float bottom = p(vTexCoord - unit.xy);\n\n      vec2 gradient = (vec2(right - left, top - bottom) / 1.0) + 0.0002;\n\n      vec2 uA = texture2D(uVelocityTexture, vTexCoord).xy;\n\n      float uX = uA.x - (uTimeStep/(2.0 * uDensity * uGridUnit)) * gradient.x;\n      float uY = uA.y - (uTimeStep/(2.0 * uDensity * uGridUnit)) * gradient.y;\n\n      gl_FragColor = vec4(uX, uY, 0., 1.);\n    }"]);return ke=function(){return e},e}function le(){var e=zb(["\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vTexCoord;\n\n    uniform float uGridUnit;\n    uniform sampler2D uDivergenceTexture;\n    uniform sampler2D uPressureTexture;\n\n    float u(vec2 coords) {\n      return texture2D(uPressureTexture, fract(coords)).x;\n    }\n\n    float gridUnit = 2.0 * uGridUnit;\n    vec2 unit = vec2(0., gridUnit);\n\n    void main() {\n      float divergence = texture2D(uDivergenceTexture, fract(vTexCoord)).x;\n\n      float pressure = (1./4.) * (\n        divergence\n        + u(vTexCoord + unit.yx)\n        + u(vTexCoord - unit.yx)\n        + u(vTexCoord + unit.xy)\n        + u(vTexCoord - unit.xy)\n      );\n\n      gl_FragColor = vec4(pressure, 0., 0., 1.);\n    }"]);return le=function(){return e},e}function zb(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function me(e,t){var r=t.state.water,n=r.attributes,u=r.indices,i=r.parameters,s=i.timestep,o=i.density,a=i.gridUnit,p=i.jacobiIterations,l=r.textures,c=l.pressure1,x=l.pressure2,v=l.velocity1,f=l.velocity2,$=l.divergence,d=r.swap,m=h(le()),T=h(ke()),g={pass:e.pass({color:[c]}),pipeline:e.pipeline({vert:q,frag:m}),attributes:n,indices:u,uniforms:{uTimeStep:s,uDensity:o,uGridUnit:a,uDivergenceTexture:$,uPressureTexture:x}},y={pass:e.pass({color:[f]}),pipeline:e.pipeline({vert:q,frag:T}),attributes:n,indices:u,uniforms:{uTimeStep:s,uDensity:o,uGridUnit:a,uVelocityTexture:v,uPressureTexture:c}};return function(){for(var r=0;r<p;r++)e.submit(g,{pass:e.pass({color:[t.state.water.textures.pressure2]}),uniforms:{uPressureTexture:t.state.water.textures.pressure1}}),e.submit(g,{pass:e.pass({color:[t.state.water.textures.pressure1]}),uniforms:{uPressureTexture:t.state.water.textures.pressure2}});e.submit(y,{pass:e.pass({color:[t.state.water.textures.velocity2]}),uniforms:{uVelocityTexture:t.state.water.textures.velocity1,uPressureTexture:t.state.water.textures.pressure1}}),d("velocity1","velocity2")}}function ne(){var e=V(["\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vTexCoord;\n    uniform sampler2D uVelocityTexture;\n\n    void main() {\n      vec2 velocity = texture2D(uVelocityTexture, vTexCoord).xy;\n      vec3 color = vec3(velocity, 0.0);\n      color = normalize(color);\n      gl_FragColor = vec4(color, 1.0);\n    }"]);return ne=function(){return e},e}function oe(){var e=V(["\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vTexCoord;\n    uniform sampler2D uVelocityTexture;\n\n    float texel = 1./1024.0;\n    float normalStrength = 50.;\n    vec3 gr = vec3(0.299, 0.587, 0.114);\n\n    void main() {\n      vec2 velocity = texture2D(uVelocityTexture, vTexCoord).xy;\n      vec2 velocityRight = texture2D(uVelocityTexture, vTexCoord + vec2(texel, 0.)).xy;\n      vec2 velocityUp = texture2D(uVelocityTexture, vTexCoord + vec2(0., texel)).xy;\n\n      float color = dot(vec3(1.0) - length(velocity * 2. - 1.), gr);\n      float colorRight = dot(vec3(1.0) - length(velocityRight * 2. - 1.), gr);\n      float colorUp = dot(vec3(1.0) - length(velocityUp * 2. - 1.), gr);\n\n      float deltaRight = colorRight - color;\n      float deltaUp = colorUp - color;\n\n      vec3 graynorm = cross(\n        vec3(1, 0, deltaRight * normalStrength),\n        vec3(0, 1, deltaUp * normalStrength)\n      );\n\n      vec3 normal = normalize(graynorm);\n\n      gl_FragColor = vec4(normal, 1.0);\n    }"]);return oe=function(){return e},e}function pe(){var e=V(["\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vTexCoord;\n    uniform sampler2D uVelocityTexture;\n\n    void main() {\n      vec2 velocity = texture2D(uVelocityTexture, vTexCoord).xy;\n      vec3 color = vec3(1.0) - length(velocity * 2.0 - 1.0) * 0.2;\n      gl_FragColor = vec4(color, 1.0);\n      // gl_FragColor.rgb += color * 0.25 + 0.25;\n    }"]);return pe=function(){return e},e}function qe(){var e=V(["\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vTexCoord;\n    uniform sampler2D uVelocityTexture;\n\n    float dot2(vec2 v) {\n      return dot(v, v);\n    }\n\n    void main() {\n      vec2 velocity = texture2D(uVelocityTexture, vTexCoord).xy;\n      vec3 color = vec3(0.2, 0.5, 0.8) - vec3(velocity, dot2(velocity));\n\n      gl_FragColor = vec4(color, 1.0);\n      // gl_FragColor.rgb = normalize(gl_FragColor.rgb);\n    }"]);return qe=function(){return e},e}function V(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function re(e,t){var o=t.state.water,r=o.indices,n=o.attributes,c=o.textures,l=c.color1,a=c.velocity1,i=h(qe()),v=(h(pe()),h(oe()),h(ne()),{pass:e.pass({color:[l]}),pipeline:e.pipeline({vert:q,frag:i}),attributes:n,indices:r,uniforms:{uVelocityTexture:a}});return function(){e.submit(v,{pass:e.pass({color:[t.state.water.textures.color1]}),uniforms:{uVelocityTexture:t.state.water.textures.velocity1}})}}function se(){var e=te(["\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vTexCoord;\n\n    uniform vec2 uResolution;\n    uniform sampler2D uColorTexture;\n\n    vec4 fxaa(sampler2D tex, vec2 uv, vec2 resolution) {\n      vec2 pixel = vec2(1) / resolution;\n      vec3 l = vec3(0.299, 0.587, 0.114);\n      float lNW = dot(texture2D(tex, uv + vec2(-1, -1) * pixel).rgb, l);\n      float lNE = dot(texture2D(tex, uv + vec2( 1, -1) * pixel).rgb, l);\n      float lSW = dot(texture2D(tex, uv + vec2(-1,  1) * pixel).rgb, l);\n      float lSE = dot(texture2D(tex, uv + vec2( 1,  1) * pixel).rgb, l);\n      float lM  = dot(texture2D(tex, uv).rgb, l);\n      float lMin = min(lM, min(min(lNW, lNE), min(lSW, lSE)));\n      float lMax = max(lM, max(max(lNW, lNE), max(lSW, lSE)));\n\n      vec2 dir = vec2(\n        -((lNW + lNE) - (lSW + lSE)),\n        ((lNW + lSW) - (lNE + lSE))\n      );\n\n      float dirReduce = max((lNW + lNE + lSW + lSE) * 0.03125, 0.0078125);\n      float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n      dir = min(vec2(8, 8), max(vec2(-8, -8), dir * rcpDirMin)) * pixel;\n\n      vec3 rgbA = 0.5 * (\n        texture2D(tex, uv + dir * (1.0 / 3.0 - 0.5)).rgb +\n        texture2D(tex, uv + dir * (2.0 / 3.0 - 0.5)).rgb);\n      vec3 rgbB = rgbA * 0.5 + 0.25 * (\n        texture2D(tex, uv + dir * -0.5).rgb +\n        texture2D(tex, uv + dir * 0.5).rgb);\n      float lB = dot(rgbB, l);\n      return mix(\n        vec4(rgbB, 1),\n        vec4(rgbA, 1),\n        max(sign(lB - lMin), 0.0) * max(sign(lB - lMax), 0.0)\n      );\n    }\n\n    void main() {\n      vec4 aa = fxaa(uColorTexture, vTexCoord, uResolution);\n      gl_FragColor = aa;\n    }"]);return se=function(){return e},e}function te(e,r){return r||(r=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(r)}}))}function ue(e,r){var t=r.state.water,l=t.indices,n=t.attributes,i=t.textures,a=i.color1,o=i.color2,u=t.swap,x=h(se()),c={pass:e.pass({color:[o]}),pipeline:e.pipeline({vert:q,frag:x}),attributes:n,indices:l,uniforms:{uResolution:[r.width,r.height],uColorTexture:a}};return function(){e.submit(c,{pass:e.pass({color:[r.state.water.textures.color2]}),uniforms:{uColorTexture:r.state.water.textures.color1}}),u("color1","color2")}}function ve(){var e=Ab(["\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vTexCoord;\n\n    uniform bool uDragging;\n    uniform float uTimeStep;\n    uniform vec2 uResolution;\n    uniform vec2 uMouse;\n    uniform sampler2D uInputTexture;\n\n    void main() {\n      gl_FragColor = texture2D(uInputTexture, fract(vTexCoord));\n\n      if (uDragging) {\n        float dist = distance(uMouse, vTexCoord);\n        float radius = .1 * uResolution.x/uResolution.y / 2.;\n\n        radius /= exp(dist);\n\n        if (dist < radius) {\n          float ratio = log(dist * radius);\n\n          vec2 dir = (uMouse / uResolution) * vTexCoord;\n          gl_FragColor.rg += dir / vec2(pow(ratio, .006125));\n\n          // vec2 dir = uMouse - vTexCoord;\n          // gl_FragColor.rg /= dot(vec2(dir), gl_FragColor.xy) * vec2(1.);\n          gl_FragColor.rg += (vec2(.75) * ( (2. * dist / radius - 1.)  * 0.5 - 0.5 ));\n        }\n\n        // if (dist < radius) gl_FragColor.rgb += (vec3(.75) * ( (2. * dist / radius - 1.)  * 0.5 - 0.5 ));\n      }\n    }"]);return ve=function(){return e},e}function we(){var e=Ab(["\n    precision highp float;\n    precision highp sampler2D;\n\n    varying vec2 vTexCoord;\n\n    uniform bool uDragging;\n    uniform float uTimeStep;\n    uniform vec2 uResolution;\n    uniform vec2 uMouse;\n    uniform sampler2D uInputTexture;\n\n    void main() {\n      gl_FragColor = texture2D(uInputTexture, fract(vTexCoord));\n\n      if (uDragging) {\n        float dist = distance(uMouse, vTexCoord);\n        float radius = .1;\n\n        if (dist < radius) {\n          float ratio = log(dist / radius);\n          vec2 dir = uMouse - vTexCoord;\n          gl_FragColor.rg /= dot(vec2(dir), gl_FragColor.xy) * vec2(1.);\n        }\n      }\n    }"]);return we=function(){return e},e}function Ab(e,r){return r||(r=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(r)}}))}function xe(e,r){var t=r.state.water,n=t.attributes,o=t.indices,i=t.parameters.timestep,u=t.textures,a=u.velocity1,s=u.velocity2,l=t.swap,g=(h(we()),h(ve())),d={pass:e.pass({color:[s]}),pipeline:e.pipeline({vert:q,frag:g}),attributes:n,indices:o,uniforms:{uMouse:[0,0],uTimeStep:i,uInputTexture:a}};return function(){var t=r.state,n=t.mx,o=t.my,i=t.dragging,u=t.water;e.submit(d,{pass:e.pass({color:[u.textures.velocity2]}),uniforms:{uResolution:[r.width,r.height],uDragging:i,uMouse:[n,o],uInputTexture:u.textures.velocity1}}),l("velocity1","velocity2")}}function ye(){var n=Bb(["\nprecision highp int;\nprecision highp float;\n\nuniform vec2 iMouse;\nuniform vec2 iResolution;\nuniform vec2 iFrame;\nuniform float iTime;\n\n\n// The MIT License\n// Copyright \xA9 2013 Inigo Quilez\n// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\n// A list of useful distance function to simple primitives. All\n// these functions (except for ellipsoid) return an exact\n// euclidean distance, meaning they produce a better SDF than\n// what you'd get if you were constructing them from boolean\n// operations.\n//\n// More info here:\n//\n// http://www.iquilezles.org/www/articles/distfunctions/distfunctions.htm\n\n//------------------------------------------------------------------\n\nfloat sdPlane( vec3 p )\n{\n\treturn p.y;\n}\n\nfloat sdSphere( vec3 p, float s )\n{\n    return length(p)-s;\n}\n\n// float sdBox( vec3 p, vec3 b )\n// {\n//     vec3 d = abs(p) - b;\n//     return min(max(d.x,max(d.y,d.z)),0.0) + length(max(d,0.0));\n// }\n\nfloat sdEllipsoid( in vec3 p, in vec3 r ) // approximated\n{\n    float k0 = length(p/r);\n    float k1 = length(p/(r*r));\n    return k0*(k0-1.0)/k1;\n\n}\n\nfloat sdTorus( vec3 p, vec2 t )\n{\n    return length( vec2(length(p.xz)-t.x,p.y) )-t.y;\n}\n\nfloat sdCappedTorus(in vec3 p, in vec2 sc, in float ra, in float rb)\n{\n    p.x = abs(p.x);\n    float k = (sc.y*p.x>sc.x*p.y) ? dot(p.xy,sc) : length(p.xy);\n    return sqrt( dot(p,p) + ra*ra - 2.0*ra*k ) - rb;\n}\n\nfloat sdHexPrism( vec3 p, vec2 h )\n{\n    vec3 q = abs(p);\n\n    const vec3 k = vec3(-0.8660254, 0.5, 0.57735);\n    p = abs(p);\n    p.xy -= 2.0*min(dot(k.xy, p.xy), 0.0)*k.xy;\n    vec2 d = vec2(\n       length(p.xy - vec2(clamp(p.x, -k.z*h.x, k.z*h.x), h.x))*sign(p.y - h.x),\n       p.z-h.y );\n    return min(max(d.x,d.y),0.0) + length(max(d,0.0));\n}\n\nfloat sdCapsule( vec3 p, vec3 a, vec3 b, float r )\n{\n\tvec3 pa = p-a, ba = b-a;\n\tfloat h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );\n\treturn length( pa - ba*h ) - r;\n}\n\nfloat sdRoundCone( in vec3 p, in float r1, float r2, float h )\n{\n    vec2 q = vec2( length(p.xz), p.y );\n\n    float b = (r1-r2)/h;\n    float a = sqrt(1.0-b*b);\n    float k = dot(q,vec2(-b,a));\n\n    if( k < 0.0 ) return length(q) - r1;\n    if( k > a*h ) return length(q-vec2(0.0,h)) - r2;\n\n    return dot(q, vec2(a,b) ) - r1;\n}\n\nfloat dot2(in vec3 v ) {return dot(v,v);}\nfloat sdRoundCone(vec3 p, vec3 a, vec3 b, float r1, float r2)\n{\n    // sampling independent computations (only depend on shape)\n    vec3  ba = b - a;\n    float l2 = dot(ba,ba);\n    float rr = r1 - r2;\n    float a2 = l2 - rr*rr;\n    float il2 = 1.0/l2;\n\n    // sampling dependant computations\n    vec3 pa = p - a;\n    float y = dot(pa,ba);\n    float z = y - l2;\n    float x2 = dot2( pa*l2 - ba*y );\n    float y2 = y*y*l2;\n    float z2 = z*z*l2;\n\n    // single square root!\n    float k = sign(rr)*rr*rr*x2;\n    if( sign(z)*a2*z2 > k ) return  sqrt(x2 + z2)        *il2 - r2;\n    if( sign(y)*a2*y2 < k ) return  sqrt(x2 + y2)        *il2 - r1;\n                            return (sqrt(x2*a2*il2)+y*rr)*il2 - r1;\n}\n\nfloat sdEquilateralTriangle(  in vec2 p )\n{\n    const float k = 1.73205;//sqrt(3.0);\n    p.x = abs(p.x) - 1.0;\n    p.y = p.y + 1.0/k;\n    if( p.x + k*p.y > 0.0 ) p = vec2( p.x - k*p.y, -k*p.x - p.y )/2.0;\n    p.x += 2.0 - 2.0*clamp( (p.x+2.0)/2.0, 0.0, 1.0 );\n    return -length(p)*sign(p.y);\n}\n\nfloat sdTriPrism( vec3 p, vec2 h )\n{\n    vec3 q = abs(p);\n    float d1 = q.z-h.y;\n    h.x *= 0.866025;\n    float d2 = sdEquilateralTriangle(p.xy/h.x)*h.x;\n    return length(max(vec2(d1,d2),0.0)) + min(max(d1,d2), 0.);\n}\n\n// vertical\nfloat sdCylinder( vec3 p, vec2 h )\n{\n    vec2 d = abs(vec2(length(p.xz),p.y)) - h;\n    return min(max(d.x,d.y),0.0) + length(max(d,0.0));\n}\n\n// arbitrary orientation\nfloat sdCylinder(vec3 p, vec3 a, vec3 b, float r)\n{\n    vec3 pa = p - a;\n    vec3 ba = b - a;\n    float baba = dot(ba,ba);\n    float paba = dot(pa,ba);\n\n    float x = length(pa*baba-ba*paba) - r*baba;\n    float y = abs(paba-baba*0.5)-baba*0.5;\n    float x2 = x*x;\n    float y2 = y*y*baba;\n    float d = (max(x,y)<0.0)?-min(x2,y2):(((x>0.0)?x2:0.0)+((y>0.0)?y2:0.0));\n    return sign(d)*sqrt(abs(d))/baba;\n}\n\n// vertical\nfloat sdCone( in vec3 p, in vec3 c )\n{\n    vec2 q = vec2( length(p.xz), p.y );\n    float d1 = -q.y-c.z;\n    float d2 = max( dot(q,c.xy), q.y);\n    return length(max(vec2(d1,d2),0.0)) + min(max(d1,d2), 0.);\n}\n\nfloat dot2( in vec2 v ) { return dot(v,v); }\nfloat sdCone( in vec3 p, in float h, in float r1, in float r2 )\n{\n    vec2 q = vec2( length(p.xz), p.y );\n\n    vec2 k1 = vec2(r2,h);\n    vec2 k2 = vec2(r2-r1,2.0*h);\n    vec2 ca = vec2(q.x-min(q.x,(q.y < 0.0)?r1:r2), abs(q.y)-h);\n    vec2 cb = q - k1 + k2*clamp( dot(k1-q,k2)/dot2(k2), 0.0, 1.0 );\n    float s = (cb.x < 0.0 && ca.y < 0.0) ? -1.0 : 1.0;\n    return s*sqrt( min(dot2(ca),dot2(cb)) );\n}\n\n// http://iquilezles.org/www/articles/distfunctions/distfunctions.htm\nfloat sdCone(vec3 p, vec3 a, vec3 b, float ra, float rb)\n{\n    float rba  = rb-ra;\n    float baba = dot(b-a,b-a);\n    float papa = dot(p-a,p-a);\n    float paba = dot(p-a,b-a)/baba;\n\n    float x = sqrt( papa - paba*paba*baba );\n\n    float cax = max(0.0,x-((paba<0.5)?ra:rb));\n    float cay = abs(paba-0.5)-0.5;\n\n    float k = rba*rba + baba;\n    float f = clamp( (rba*(x-ra)+paba*baba)/k, 0.0, 1.0 );\n\n    float cbx = x-ra - f*rba;\n    float cby = paba - f;\n\n    float s = (cbx < 0.0 && cay < 0.0) ? -1.0 : 1.0;\n\n    return s*sqrt( min(cax*cax + cay*cay*baba,\n                       cbx*cbx + cby*cby*baba) );\n}\n\n// c is the sin/cos of the desired cone angle\nfloat sdSolidAngle(vec3 pos, vec2 c, float ra)\n{\n    vec2 p = vec2( length(pos.xz), pos.y );\n    float l = length(p) - ra;\n\tfloat m = length(p - c*clamp(dot(p,c),0.0,ra) );\n    return max(l,m*sign(c.y*p.x-c.x*p.y));\n}\n\nfloat sdOctahedron(vec3 p, float s)\n{\n    p = abs(p);\n    float m = p.x + p.y + p.z - s;\n\n    // exact distance\n    #if 0\n    vec3 o = min(3.0*p - m, 0.0);\n    o = max(6.0*p - m*2.0 - o*3.0 + (o.x+o.y+o.z), 0.0);\n    return length(p - s*o/(o.x+o.y+o.z));\n    #endif\n\n    // exact distance\n    #if 1\n \tvec3 q;\n         if( 3.0*p.x < m ) q = p.xyz;\n    else if( 3.0*p.y < m ) q = p.yzx;\n    else if( 3.0*p.z < m ) q = p.zxy;\n    else return m*0.57735027;\n    float k = clamp(0.5*(q.z-q.y+s),0.0,s);\n    return length(vec3(q.x,q.y-s+k,q.z-k));\n    #endif\n\n    // bound, not exact\n    #if 0\n\treturn m*0.57735027;\n    #endif\n}\n\n\n//------------------------------------------------------------------\n\n#if HW_PERFORMANCE==0\n#define AA 1\n#else\n#define AA 2   // make this 2 or 3 for antialiasing\n#endif\n\n//------------------------------------------------------------------\n\nvec2 opU( vec2 d1, vec2 d2 )\n{\n\treturn (d1.x<d2.x) ? d1 : d2;\n}\n\n//------------------------------------------------------------------\n\n#define ZERO (min(iFrame,0))\n\n//------------------------------------------------------------------\n\nvec2 map( in vec3 pos )\n{\n    vec2 res = vec2( 1e10, 0.0 );\n\n    if( pos.x>-2.5 && pos.x<0.5 )\n    {\n\tres = opU( res, vec2( sdOctahedron( pos-vec3(-1.0,0.15,-2.0), 0.35 ), 23.56 ) );\n    res = opU( res, vec2( sdTriPrism(  pos-vec3(-1.0,0.25,-1.0), vec2(0.25,0.05) ),43.5 ) );\n\tres = opU( res, vec2( sdHexPrism(  pos-vec3(-1.0,0.20, 1.0), vec2(0.25,0.05) ),17.0 ) );\n    res = opU( res, vec2( sdEllipsoid( pos-vec3(-1.0,0.30, 0.0), vec3(0.2, 0.25, 0.05) ), 43.17 ) );\n    }\n    if( pos.x>-1.5 && pos.x<1.5 )\n    {\n    res = opU( res, vec2( sdSphere(    pos-vec3( 0.0,0.25, 0.0), 0.25 ), 46.9 ) );\n\tres = opU( res, vec2( sdTorus(     pos-vec3( 0.0,0.25, 1.0), vec2(0.20,0.05) ), 25.0 ) );\n\tres = opU( res, vec2( sdCone(      pos-vec3( 0.0,0.50,-1.0), vec3(0.8,0.6,0.3) ), 55.0 ) );\n    res = opU( res, vec2( sdCone(      pos-vec3( 0.0,0.35,-2.0), 0.15, 0.2, 0.1 ), 13.67 ) );\n    res = opU( res, vec2( sdSolidAngle(pos-vec3( 0.0,0.20,-3.0), vec2(3,4)/5.0, 0.4 ), 49.13 ) );\n    }\n    if( pos.x>-0.5 && pos.x<2.5 )\n    {\n\tres = opU( res, vec2( sdCappedTorus((pos-vec3( 1.0,0.20, 1.0)).xzy, vec2(0.866025,-0.5), 0.2, 0.05), 8.5) );\n    res = opU( res, vec2( sdBox(       pos-vec3( 1.0,0.25, 0.0), vec3(0.25) ), 3.0 ) );\n    res = opU( res, vec2( sdCapsule(   pos-vec3( 1.0,0.00,-1.0),vec3(-0.1,0.1,-0.1), vec3(0.2,0.4,0.2), 0.1  ), 31.9 ) );\n\tres = opU( res, vec2( sdCylinder(  pos-vec3( 1.0,0.30,-2.0), vec2(0.1,0.2) ), 8.0 ) );\n    }\n    if( pos.x>0.5 )\n    {\n    res = opU( res, vec2( sdCylinder(  pos-vec3( 2.0,0.20,-2.0), vec3(0.1,-0.1,0.0), vec3(-0.1,0.3,0.1), 0.08), 31.2 ) );\n\tres = opU( res, vec2( sdCone(      pos-vec3( 2.0,0.20,-1.0), vec3(0.1,0.0,0.0), vec3(-0.1,0.3,0.1), 0.15, 0.05), 46.1 ) );\n    res = opU( res, vec2( sdRoundCone( pos-vec3( 2.0,0.20, 0.0), vec3(0.1,0.0,0.0), vec3(-0.1,0.3,0.1), 0.15, 0.05), 51.7 ) );\n    res = opU( res, vec2( sdRoundCone( pos-vec3( 2.0,0.20, 1.0), 0.2, 0.1, 0.3 ), 37.0 ) );\n    }\n\n\n\t//res = min( res, sdBox(pos-vec3(0.5,0.4,-0.5), vec3(2.0,0.41,2.0) ) );\n    return res;\n}\n\n// http://iquilezles.org/www/articles/boxfunctions/boxfunctions.htm\nvec2 iBox( in vec3 ro, in vec3 rd, in vec3 rad )\n{\n    vec3 m = 1.0/rd;\n    vec3 n = m*ro;\n    vec3 k = abs(m)*rad;\n    vec3 t1 = -n - k;\n    vec3 t2 = -n + k;\n\treturn vec2( max( max( t1.x, t1.y ), t1.z ),\n\t             min( min( t2.x, t2.y ), t2.z ) );\n}\n\nconst float maxHei = 0.8;\n\nvec2 castRay( in vec3 ro, in vec3 rd )\n{\n    vec2 res = vec2(-1.0,-1.0);\n\n    float tmin = 1.0;\n    float tmax = 20.0;\n\n    // raytrace floor plane\n    float tp1 = (0.0-ro.y)/rd.y;\n    if( tp1>0.0 )\n    {\n        tmax = min( tmax, tp1 );\n        res = vec2( tp1, 1.0 );\n    }\n    //else return res;\n\n    // raymarch primitives\n    vec2 tb = iBox( ro-vec3(0.5,0.4,-0.5), rd, vec3(2.0,0.41,3.0) );\n    if( tb.x<tb.y && tb.y>0.0 && tb.x<tmax)\n    {\n        tmin = max(tb.x,tmin);\n        tmax = min(tb.y,tmax);\n\n        float t = tmin;\n        for( int i=0; i<70 && t<tmax; i++ )\n        {\n            vec2 h = map( ro+rd*t );\n            if( abs(h.x)<(0.0001*t) )\n            {\n                res = vec2(t,h.y);\n                 break;\n            }\n            t += h.x;\n        }\n    }\n\n    return res;\n}\n\n\n// http://iquilezles.org/www/articles/rmshadows/rmshadows.htm\nfloat calcSoftshadow( in vec3 ro, in vec3 rd, in float mint, in float tmax )\n{\n    // bounding volume\n    float tp = (maxHei-ro.y)/rd.y; if( tp>0.0 ) tmax = min( tmax, tp );\n\n    float res = 1.0;\n    float t = mint;\n    for( int i=ZERO; i<16; i++ )\n    {\n\t\tfloat h = map( ro + rd*t ).x;\n        float s = clamp(8.0*h/t,0.0,1.0);\n        res = min( res, s*s*(3.0-2.0*s) );\n        t += clamp( h, 0.02, 0.10 );\n        if( res<0.005 || t>tmax ) break;\n    }\n    return clamp( res, 0.0, 1.0 );\n}\n\n// http://iquilezles.org/www/articles/normalsSDF/normalsSDF.htm\nvec3 calcNormal( in vec3 pos )\n{\n#if 0\n    vec2 e = vec2(1.0,-1.0)*0.5773*0.0005;\n    return normalize( e.xyy*map( pos + e.xyy ).x +\n\t\t\t\t\t  e.yyx*map( pos + e.yyx ).x +\n\t\t\t\t\t  e.yxy*map( pos + e.yxy ).x +\n\t\t\t\t\t  e.xxx*map( pos + e.xxx ).x );\n#else\n    // inspired by klems - a way to prevent the compiler from inlining map() 4 times\n    vec3 n = vec3(0.0);\n    for( int i=ZERO; i<4; i++ )\n    {\n        vec3 e = 0.5773*(2.0*vec3(-1.0));\n        // vec3 e = 0.5773*(2.0*vec3((((i+3)>>1)&1),((i>>1)&1),(i&1))-1.0);\n        n += e*map(pos+0.0005*e).x;\n    }\n    return normalize(n);\n#endif\n}\n\nfloat calcAO( in vec3 pos, in vec3 nor )\n{\n\tfloat occ = 0.0;\n    float sca = 1.0;\n    for( int i=ZERO; i<5; i++ )\n    {\n        float hr = 0.01 + 0.12*float(i)/4.0;\n        vec3 aopos =  nor * hr + pos;\n        float dd = map( aopos ).x;\n        occ += -(dd-hr)*sca;\n        sca *= 0.95;\n    }\n    return clamp( 1.0 - 3.0*occ, 0.0, 1.0 ) * (0.5+0.5*nor.y);\n}\n\n// http://iquilezles.org/www/articles/checkerfiltering/checkerfiltering.htm\nfloat checkersGradBox( in vec2 p, in vec2 dpdx, in vec2 dpdy )\n{\n    // filter kernel\n    vec2 w = abs(dpdx)+abs(dpdy) + 0.001;\n    // analytical integral (box filter)\n    vec2 i = 2.0*(abs(fract((p-0.5*w)*0.5)-0.5)-abs(fract((p+0.5*w)*0.5)-0.5))/w;\n    // xor pattern\n    return 0.5 - 0.5*i.x*i.y;\n}\n\nvec3 render( in vec3 ro, in vec3 rd, in vec3 rdx, in vec3 rdy )\n{\n    vec3 col = vec3(0.7, 0.7, 0.9) - max(rd.y,0.0)*0.3;\n    vec2 res = castRay(ro,rd);\n    float t = res.x;\n\tfloat m = res.y;\n    if( m>-0.5 )\n    {\n        vec3 pos = ro + t*rd;\n        vec3 nor = (m<1.5) ? vec3(0.0,1.0,0.0) : calcNormal( pos );\n        vec3 ref = reflect( rd, nor );\n\n        // material\n\t\tcol = 0.2 + 0.18*sin( vec3(0.05,0.08,0.10)*(m-1.0) );\n        //col = vec3(0.2);\n        col = 0.2 + 0.18*sin( m*2.0 + vec3(0.0,0.5,1.0) );\n        if( m<1.5 )\n        {\n            // project pixel footprint into the plane\n            vec3 dpdx = ro.y*(rd/rd.y-rdx/rdx.y);\n            vec3 dpdy = ro.y*(rd/rd.y-rdy/rdy.y);\n\n            float f = checkersGradBox( 5.0*pos.xz, 5.0*dpdx.xz, 5.0*dpdy.xz );\n            col = 0.15 + f*vec3(0.05);\n        }\n\n        // lighting\n        float occ = calcAO( pos, nor );\n\t\tvec3  lig = normalize( vec3(-0.5, 0.4, -0.6) );\n        vec3  hal = normalize( lig-rd );\n\t\tfloat amb = sqrt(clamp( 0.5+0.5*nor.y, 0.0, 1.0 ));\n        float dif = clamp( dot( nor, lig ), 0.0, 1.0 );\n        float bac = clamp( dot( nor, normalize(vec3(-lig.x,0.0,-lig.z))), 0.0, 1.0 )*clamp( 1.0-pos.y,0.0,1.0);\n        float dom = smoothstep( -0.2, 0.2, ref.y );\n        float fre = pow( clamp(1.0+dot(nor,rd),0.0,1.0), 2.0 );\n\n        dif *= calcSoftshadow( pos, lig, 0.02, 2.5 );\n        dom *= calcSoftshadow( pos, ref, 0.02, 2.5 );\n\n\t\tfloat spe = pow( clamp( dot( nor, hal ), 0.0, 1.0 ),16.0)*\n                    dif *\n                    (0.04 + 0.96*pow( clamp(1.0+dot(hal,rd),0.0,1.0), 5.0 ));\n\n\t\tvec3 lin = vec3(0.0);\n        lin += 3.80*dif*vec3(1.30,1.00,0.70);\n        lin += 0.55*amb*vec3(0.40,0.60,1.15)*occ;\n        lin += 0.85*dom*vec3(0.40,0.60,1.30)*occ;\n        lin += 0.55*bac*vec3(0.25,0.25,0.25)*occ;\n        lin += 0.25*fre*vec3(1.00,1.00,1.00)*occ;\n\t\tcol = col*lin;\n\t\tcol += 7.00*spe*vec3(1.10,0.90,0.70);\n\n        col = mix( col, vec3(0.7,0.7,0.9), 1.0-exp( -0.0001*t*t*t ) );\n    }\n\n\treturn vec3( clamp(col,0.0,1.0) );\n}\n\nmat3 setCamera( in vec3 ro, in vec3 ta, float cr )\n{\n\tvec3 cw = normalize(ta-ro);\n\tvec3 cp = vec3(sin(cr), cos(cr),0.0);\n\tvec3 cu = normalize( cross(cw,cp) );\n\tvec3 cv =          ( cross(cu,cw) );\n    return mat3( cu, cv, cw );\n}\n\nvoid main( out vec4 fragColor, in vec2 fragCoord )\n{\n    vec2 mo = iMouse.xy/iResolution.xy;\n\tfloat time = 15.0 + iTime*1.5;\n\n    // camera\n    vec3 ta = vec3( 0.5, -0.4, -0.5 );\n    vec3 ro = ta + vec3( 3.8*cos(0.1*time + 6.0*mo.x), 1.0 + 2.0*mo.y, 3.8*sin(0.1*time + 6.0*mo.x) );\n    // camera-to-world transformation\n    mat3 ca = setCamera( ro, ta, 0.0 );\n\n    vec3 tot = vec3(0.0);\n#if AA>1\n    for( int m=ZERO; m<AA; m++ )\n    for( int n=ZERO; n<AA; n++ )\n    {\n        // pixel coordinates\n        vec2 o = vec2(float(m),float(n)) / float(AA) - 0.5;\n        vec2 p = (2.0*(fragCoord+o)-iResolution.xy)/iResolution.y;\n#else\n        vec2 p = (2.0*fragCoord-iResolution.xy)/iResolution.y;\n#endif\n\n        // ray direction\n        vec3 rd = ca * normalize( vec3(p,2.0) );\n\n         // ray differentials\n        vec2 px = (2.0*(fragCoord+vec2(1.0,0.0))-iResolution.xy)/iResolution.y;\n        vec2 py = (2.0*(fragCoord+vec2(0.0,1.0))-iResolution.xy)/iResolution.y;\n        vec3 rdx = ca * normalize( vec3(px,2.0) );\n        vec3 rdy = ca * normalize( vec3(py,2.0) );\n\n        // render\n        vec3 col = render( ro, rd, rdx, rdy );\n\n\t\t// gamma\n        col = pow( col, vec3(0.4545) );\n\n        tot += col;\n#if AA>1\n    }\n    tot /= float(AA*AA);\n#endif\n\n\n    fragColor = vec4( tot, 1.0 );\n}"]);return ye=function(){return n},n}function ze(){var n=Bb(["\n    #define MAX_STEPS 100\n    #define MAX_DIST 100.\n    #define SURF_DIST .01\n\n    precision highp float;\n\n    varying vec2 vTexCoord;\n\n    uniform float uTime;\n    uniform vec2 uResolution;\n\n    float map(vec3 p) {\n      vec4 s = vec4(0., 1., 6, 1);\n\n      float sphereDist = length(p - s.xyz) - s.w;\n\n      float planeDist = p.y;\n\n      float d = min(sphereDist, planeDist);\n\n      return d;\n    }\n\n    float castRay(vec3 ro, vec3 rd) {\n      float dO = 0.;\n\n      for (int i = 0; i < MAX_STEPS; i++) {\n        vec3 p = ro + rd * dO;\n        float dS = map(p);\n        dO += dS;\n        if (dO > MAX_DIST || dS < SURF_DIST) break;\n      }\n\n      if (dO > 20.) dO=-1.;\n\n      return dO;\n    }\n\n    vec3 calcNormal(vec3 p) {\n      float d = map(p);\n      vec2 e = vec2(0.1, 0.);\n\n      vec3 n = d - vec3(\n        map(p - e.xyy),\n        map(p - e.yxy),\n        map(p - e.yyx)\n      );\n\n      return normalize(n);\n    }\n\n    void main() {\n      vec2 p = (vTexCoord.xy - 0.5) * uResolution / uResolution.y;\n      vec3 ro = vec3(0., 1., 0.);\n      vec3 rd = normalize(vec3(p.xy, 1.));\n\n      vec3 color = vec3(0.6, 0.7, 0.8);\n\n      float t = castRay(ro, rd);\n\n      if( t > 0.0 ) {\n        vec3 pos = ro + rd * t;\n        vec3 nor = calcNormal(pos);\n\n        vec3 light = vec3(0.8, 0.4, 0.2);\n        light.xz += vec2(sin(uTime), cos(uTime));\n\n        vec3 sun_dir = normalize( light - pos );\n        float sun_dif = clamp( dot(nor, sun_dir), 0., 1. );\n        float sun_sha = step( castRay(pos + nor*0.001, sun_dir), 0., 1. );\n        float sky_dif = clamp( 0.5 + 0.5*dot(nor, vec3(0., 1., 0.)), 0., 1. );\n\n        color  = vec3(1., 0.7, 0.5) * sun_dif * sun_sha;\n        color += vec3(0., 0.1, 0.2) * sky_dif;\n      }\n\n      gl_FragColor.rgb = color;\n      gl_FragColor.a = 1.0;\n    }"]);return ze=function(){return n},n}function Bb(n,e){return e||(e=n.slice(0)),Object.freeze(Object.defineProperties(n,{raw:{value:Object.freeze(e)}}))}var Ke=h(ze());var Le=h(ye());var Ae=[Xd],Be={gl:{}};document.addEventListener("DOMContentLoaded",function(){window.app=qa.set("options",Be).initialize({context:"webgl"});var $b4AV$$interop$default=Cb(fd);var o=$b4AV$$interop$default.d({gl:qa.gl});qa.render(o,Ae)});})();